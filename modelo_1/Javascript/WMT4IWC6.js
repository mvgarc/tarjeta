import {a as Nr} from "./UAB7UEHC.js";
import {a as Hr} from "./SGC75SOE.js";
import {a as Fr, b as Eo, c as Gr} from "./TF76H6AL.js";
import {b as Zo, c as Wr} from "./GFPEESYZ.js";
import {a as en} from "./T7DUZK3V.js";
import {a as Fi, b as Io, d as Pr, f as Br, i as Rr, j as ye} from "./PAF4YU3F.js";
import {a as Qo} from "./34DRO76C.js";
import {c as Mo, e as Lr} from "./OBRG2XHR.js";
import {a as Vn, b as kr} from "./KUAISU4J.js";
import {a as Dr} from "./JSHGK43H.js";
import {a as Oi} from "./RODWZCZU.js";
import {a as En} from "./FMCNH4BF.js";
import {a as Di, c as zr} from "./PE3JEF7Q.js";
import {f as Jo} from "./E4LACLO2.js";
import {b as Ur} from "./T2P6AURM.js";
import {a as Or} from "./KRKN4EF2.js";
import {$a as Er, Aa as co, Ba as mr, Ca as dr, Da as fr, Ea as gr, Fa as xr, Ga as It, H as Jn, Ha as po, I as Lt, Ia as Mt, J as Qn, Ja as hr, Ka as yr, L as ce, La as mo, Ma as Cr, N as Zn, Oa as Sr, Pa as fo, Q as er, Qa as br, R as ze, Ra as Ir, S as oo, Sa as go, T as Be, Ta as Mr, U as tr, Ua as Et, V as or, Va as xo, Wa as Je, Xa as he, Ya as ho, Z as nr, Za as _t, _ as Rt, _a as at, ab as yo, bb as _r, ca as rr, cb as Le, d as jn, da as bt, e as Yn, f as Jt, ga as ir, hb as Co, ia as ro, ib as So, ja as io, jb as Ft, ka as so, kb as Yo, la as ao, lb as bo, mb as wr, nb as Tr, ob as wt, pb as vr, ra as jo, rb as Ar, sa as sr, t as St, ta as ar, ua as lr, v as Qt, va as ur, w as to, wa as cr, x as st, xa as lo, ya as pr, z as Pe, za as uo} from "./LJ7CGGK3.js";
import {a as no, b as Dt} from "./GZIKL2PN.js";
import {a as Qe} from "./UWHIXUW6.js";
import {j as ue} from "./OIC7JTCT.js";
import {d as Xo, e as qn, f as Xn, h as Fe, i as Ct} from "./PXPB4JBM.js";
import {a as qo} from "./6QCMWYPK.js";
import {d as we, r as $n, u as Kn} from "./K3GGUINO.js";
import {a as Pn, b as Yt} from "./2WSYMSYY.js";
import {b as $o, c as F} from "./IC2MQ3PR.js";
import {a as $} from "./ZQWRROIX.js";
import {a as Vo, q as G, r as N} from "./V56SQG4X.js";
import {e as bn} from "./SUT4BSCK.js";
import {a as gt, b as Oo, e as rt, g as No, m as Ho, w as In} from "./B5YK3YMW.js";
import {l as eo} from "./DAGKPUP3.js";
import {a as Zt} from "./6LS5XNTR.js";
import {Aa as Xt, Fa as jt, Ha as xt, Ia as Ye, Ja as ht, Ka as Nn, L as Bn, La as Hn, M as Ln, Ma as Wn, Pa as yt, Qa as zn, Ua as Un, W as Rn, ba as Dn, ca as Bt, d as je, da as Kt, ia as qt, ja as Fn, l as Vt, lb as ie, ob as me, q as ke, r as Ko, u as $t, w as We, yb as Gn, za as On} from "./OKMCQT75.js";
import {c as z} from "./TSKJWQGO.js";
import {d as Me, e as An, f as kn} from "./DWH3I5CV.js";
import {A as zo, E as it, S as Uo, U as Go, a as D, b as Sn, f as J, g as Q, h as re, k as qe, l as Mn, m as _n, n as Wo, o as Ut, s as wn, t as Pt, u as Gt, v as Tn, w as Xe, x as vn} from "./Q6TZRKPZ.js";
import {a as Cn} from "./3JX3VARJ.js";
import {c as Fo, f as A} from "./PQ35KENF.js";
var Kr = Fo(_o=>{
    "use strict";
    var Hi = Vo();
    Object.defineProperty(_o, "__esModule", {
        value: !0
    });
    _o.default = void 0;
    var Wi = Hi($o())
      , zi = Ho()
      , Ui = (0,
    Wi.default)((0,
    zi.jsx)("path", {
        d: "M13 11h-2v3H8v2h3v3h2v-3h3v-2h-3zm1-9H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"
    }), "NoteAddOutlined");
    _o.default = Ui
}
);
var ti = Fo(wo=>{
    "use strict";
    var qi = Vo();
    Object.defineProperty(wo, "__esModule", {
        value: !0
    });
    wo.default = void 0;
    var Xi = qi($o())
      , ji = Ho()
      , Yi = (0,
    Xi.default)((0,
    ji.jsx)("path", {
        d: "M8.59 16.59 13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"
    }), "KeyboardArrowRight");
    wo.default = Yi
}
);
var oi = Fo(To=>{
    "use strict";
    var Ji = Vo();
    Object.defineProperty(To, "__esModule", {
        value: !0
    });
    To.default = void 0;
    var Qi = Ji($o())
      , Zi = Ho()
      , es = (0,
    Qi.default)((0,
    Zi.jsx)("path", {
        d: "M19 7v4H5.83l3.58-3.59L8 6l-6 6 6 6 1.41-1.41L5.83 13H21V7z"
    }), "KeyboardReturn");
    To.default = es
}
);
var be = A(D());
var Vr = A(Di());
var Ni = ()=>{
    let o = new Map
      , t = new $t
      , e = async(n,r,i)=>{
        await t.postMessage({
            event: "Client_ListenProxyWebsocketResponse",
            data: {
                data: r,
                taskId: n,
                listenerType: i
            }
        })
    }
    ;
    qt(async(n,r)=>{
        switch (n) {
        case "Client_ListenProxyWebsocket":
            {
                let {taskId: i, data: u, type: a} = r;
                switch (a) {
                case "Open":
                    {
                        let s = u.mode
                          , c = new Vr.default(u.url,s === "bing" ? {
                            packMessage: Jo.packMessage,
                            unpackMessage: Jo.unpackMessage
                        } : {});
                        return c.onUnpackedMessage.addListener(l=>{
                            e(i, l, "onUnpackedMessage")
                        }
                        ),
                        c.onMessage.addListener(async l=>{
                            e(i, l, "onMessage")
                        }
                        ),
                        c.onClose.addListener(()=>{
                            e(i, {}, "onClose")
                        }
                        ),
                        await c.open(),
                        o.set(i, c),
                        {
                            success: !0,
                            data: "success",
                            message: "ok"
                        }
                    }
                    break;
                case "Close":
                    {
                        let s = o.get(i);
                        return s ? (s.removeAllListeners(),
                        await s.close(),
                        o.delete(i),
                        {
                            success: !0,
                            data: "success",
                            message: "ok"
                        }) : {
                            success: !1,
                            message: "websocket not found",
                            data: !1
                        }
                    }
                    break;
                case "SendPacked":
                    {
                        let s = o.get(i);
                        return s ? (s.sendPacked(u),
                        {
                            success: !0,
                            data: "success",
                            message: "ok"
                        }) : {
                            success: !1,
                            message: "websocket not found",
                            data: !1
                        }
                    }
                    break;
                default:
                    return {
                        success: !0,
                        data: "success",
                        message: "ok"
                    }
                }
            }
            break
        }
    }
    )
}
  , $r = Ni;
var Xr = A(Kr());
var B = A(D());
var jr = A(Cn());
var Yr = ()=>{
    let {t: o} = z(["common", "client"])
      , [t,e] = (0,
    B.useState)(!1)
      , [n,r] = (0,
    B.useState)(100)
      , [i,u] = (0,
    B.useState)(null)
      , [a,s] = (0,
    B.useState)(!1)
      , c = p=>{
        p.preventDefault(),
        s(!0)
    }
      , l = p=>{
        p.preventDefault()
    }
      , d = ()=>{
        s(!1)
    }
      , m = p=>{
        p.preventDefault(),
        s(!1);
        let y = p.dataTransfer.files
          , x = Array.from(y).find(S=>S.type === "application/pdf" || S.name.endsWith(".pdf"));
        if (x) {
            let S = window.PDFViewerApplication;
            S && S.open({
                url: URL.createObjectURL(x),
                originalUrl: x.name
            })
        }
    }
    ;
    return kr(()=>{
        let p = document.body.querySelector("#usechatgptPDFViewerErrorAlert");
        if (p) {
            p.style.top = "120px",
            p.style.left = "50%",
            p.style.transform = "translateX(-50%)",
            p.style.zIndex = "unset",
            r(null),
            u(p),
            e(!0);
            return
        }
    }
    , n),
    !t || !i ? null : B.default.createElement(Zo, {
        rootContainer: i,
        customElementName: "maxai-pdf-ai-viewer-error-alert"
    }, B.default.createElement(G, {
        gap: 4,
        width: "90vw",
        maxWidth: "1088px",
        sx: {
            boxSizing: "border-box"
        }
    }, B.default.createElement(G, {
        direction: "row",
        alignItems: "center",
        gap: 1,
        justifyContent: "center"
    }, B.default.createElement(we, {
        sx: {
            fontSize: "24px"
        }
    }), B.default.createElement(N, {
        fontSize: "28px",
        color: "rgba(255,255,255,.87)"
    }, "MaxAI.me")), B.default.createElement(N, {
        textAlign: "center",
        fontSize: "40px",
        fontWeight: 700,
        color: "rgba(255,255,255,.87)"
    }, o("client:pdf_ai_viewer__file_picker__title")), B.default.createElement(N, {
        textAlign: "center",
        fontSize: "18px",
        fontWeight: 400,
        color: "rgba(255,255,255,.87)"
    }, o("client:pdf_ai_viewer__file_picker__description")), B.default.createElement(G, {
        onDragEnter: c,
        onDragOver: l,
        onDragLeave: d,
        onDrop: m,
        width: "100%",
        height: 300,
        justifyContent: "center",
        alignItems: "center",
        gap: 2,
        sx: {
            borderRadius: "8px",
            padding: a ? "0" : "1px",
            border: a ? "2px dashed" : "1px dashed",
            borderColor: "primary.main",
            bgcolor: "rgba(244,235,251,1)"
        }
    }, B.default.createElement("img", {
        width: 64,
        height: 64,
        src: Zt("/images/pdf/pdf-icon.png"),
        alt: "pdf-icon"
    }), B.default.createElement(F, {
        sx: {
            borderRadius: "8px",
            bgcolor: "background.paper"
        }
    }, B.default.createElement($, {
        "data-test-id": "maxai-pdf-ai-viewer-file-picker-button",
        onClick: p=>{
            p.stopPropagation(),
            document.querySelector("#openFile")?.click()
        }
        ,
        variant: "contained",
        sx: {
            position: "relative",
            width: "320px",
            gap: 1,
            px: 4,
            py: 2,
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            color: "rgba(255,255,255,.87)"
        }
    }, B.default.createElement(Xr.default, {
        sx: {
            fontSize: "24px",
            color: "inherit"
        }
    }), B.default.createElement(N, {
        fontSize: "16px",
        fontWeight: 600
    }, o("client:pdf_ai_viewer__file_picker__button__title")), B.default.createElement(N, {
        fontSize: "14px",
        fontWeight: 400,
        color: "rgba(0,0,0,.6)",
        sx: {
            position: "absolute",
            bottom: -24
        }
    }, o("client:pdf_ai_viewer__file_picker__button__description")))))))
}
  , qr = In(({className: o, ...t})=>B.default.createElement(qn, {
    ...t,
    classes: {
        popper: o
    }
}))(({theme: o})=>({
    [`& .${Xo.tooltip}`]: {
        backgroundColor: o.palette.background.paper,
        color: o.palette.text.primary,
        fontSize: 12,
        padding: "16px",
        boxShadow: o.shadows[5],
        maxWidth: "none"
    },
    [`& .${Xo.arrow}`]: {
        color: o.palette.background.paper
    }
}))
  , Jr = ()=>{
    let {t: o} = z(["common", "client"])
      , [t,e] = (0,
    B.useState)(!1)
      , [n,r] = (0,
    B.useState)(null)
      , [i,u] = (0,
    B.useState)(!0);
    return ke(()=>{
        if (kn()) {
            jr.default.extension.isAllowedFileSchemeAccess().then(u);
            let a = document.querySelector("#toolbarViewerLeft");
            if (a) {
                let s = document.createElement("div");
                s.id = "MaxAIPDFViewerTopBarButtonGroup",
                s.style.display = "flex",
                s.style.alignItems = "center",
                s.style.height = "32px",
                a.appendChild(s),
                r(s)
            }
            e(!0)
        }
    }
    ),
    !t || !n ? null : B.default.createElement(Zo, {
        rootContainer: n,
        customElementName: "maxai-pdf-ai-viewer-top-bar-button-group"
    }, B.default.createElement(G, {
        direction: "row",
        alignItems: "center",
        gap: 1
    }, B.default.createElement(qr, {
        PopperProps: {
            sx: {
                zIndex: 99999999
            },
            container: n,
            disablePortal: !0
        },
        title: B.default.createElement(G, {
            width: 320,
            gap: 1
        }, B.default.createElement(N, {
            fontSize: "16px",
            fontWeight: 700
        }, o("client:pdf_ai_viewer__toggle_button__pdf_ai_viewer__tooltip__title")), B.default.createElement(N, {
            fontSize: "14px",
            fontWeight: 400
        }, o("client:pdf_ai_viewer__toggle_button__pdf_ai_viewer__tooltip__description1"), " ", B.default.createElement(qo, {
            color: "text.primary",
            href: "#",
            onClick: async a=>{
                a.preventDefault(),
                a.stopPropagation(),
                await me({
                    key: "options",
                    query: "?id=pdf-viewer#/appearance"
                })
            }
        }, o("client:pdf_ai_viewer__toggle_button__pdf_ai_viewer__tooltip__description2")), o("client:pdf_ai_viewer__toggle_button__pdf_ai_viewer__tooltip__description3")), B.default.createElement("img", {
            style: {
                flexShrink: 0,
                alignSelf: "center"
            },
            width: "100%",
            src: Zt("/images/pdf/guide-2.gif")
        })),
        placement: "bottom-start",
        arrow: !0
    }, B.default.createElement($, {
        "data-test-id": "maxai-pdf-ai-top-bar-settings-button",
        onClick: async()=>{
            await me({
                key: "options",
                query: "?id=pdf-viewer#/appearance"
            })
        }
        ,
        sx: {
            fontSize: "14px",
            color: "rgba(255,255,255,.87)",
            height: 32,
            display: "flex",
            alignItems: "center",
            gap: 1
        }
    }, o("client:pdf_ai_viewer__toggle_button__pdf_ai_viewer__title"), B.default.createElement(Qo, {
        checked: !0,
        size: "small"
    }))), !i && B.default.createElement(qr, {
        PopperProps: {
            sx: {
                zIndex: 99999999
            },
            container: n,
            disablePortal: !0
        },
        title: B.default.createElement(G, {
            width: 320,
            gap: 1
        }, B.default.createElement(N, {
            fontSize: "16px",
            fontWeight: 700
        }, o("client:pdf_ai_viewer__toggle_button__drag_drop_pdf__tooltip__title")), B.default.createElement(N, {
            fontSize: "14px",
            fontWeight: 400
        }, o("client:pdf_ai_viewer__toggle_button__drag_drop_pdf__tooltip__description1"), " ", B.default.createElement(qo, {
            color: "text.primary",
            href: "#",
            onClick: async a=>{
                a.preventDefault(),
                a.stopPropagation(),
                await me({
                    key: "manage_extension"
                })
            }
        }, "chrome://extensions"), o("client:pdf_ai_viewer__toggle_button__drag_drop_pdf__tooltip__description2")), B.default.createElement("img", {
            style: {
                flexShrink: 0,
                alignSelf: "center"
            },
            width: "100%",
            src: Zt("/images/pdf/guide-2.gif")
        })),
        placement: "bottom-start",
        arrow: !0
    }, B.default.createElement($, {
        "data-test-id": "maxai-pdf-ai-top-bar-auto-drag-button",
        onClick: async()=>{
            await me({
                key: "manage_extension"
            })
        }
        ,
        sx: {
            fontSize: "14px",
            color: "rgba(255,255,255,.87)",
            height: 32,
            display: "flex",
            alignItems: "center",
            gap: 1
        }
    }, o("client:pdf_ai_viewer__toggle_button__drag_drop_pdf__title"), B.default.createElement(Qo, {
        checked: i,
        size: "small"
    })))))
}
;
var lt = A(D());
var Gi = ()=>{
    let {updateSidebarConversationType: o, currentSidebarConversationType: t} = ce()
      , [e,n] = (0,
    lt.useState)({
        origin: "",
        taskId: "",
        actions: []
    })
      , {setShortCuts: r, runShortCuts: i, shortCutsEngineRef: u} = ye("")
      , a = (0,
    lt.useRef)(!1)
      , s = (c,l,d)=>{
        window.postMessage({
            id: zo,
            taskId: c,
            data: d
        }, l)
    }
    ;
    (0,
    lt.useEffect)(()=>{
        e.taskId && t === "Chat" && !a.current && (a.current = !0,
        r(e.actions),
        i(!0).then(c=>{
            s(e.taskId, e.origin, {
                success: !0,
                data: null,
                message: "ok"
            })
        }
        ).catch(c=>()=>{
            s(e.taskId, e.origin, {
                success: !1,
                data: null,
                message: "Network error."
            })
        }
        ).finally(()=>{
            n({
                taskId: "",
                actions: [],
                origin: ""
            }),
            a.current = !1
        }
        ))
    }
    , [t, e, r, i]),
    (0,
    lt.useEffect)(()=>{
        let c = async l=>{
            if (l.data?.id === zo) {
                let {eventType: d, data: m, taskId: p} = l.data;
                switch (d) {
                case "PING":
                    {
                        s(p, l.origin, {
                            success: !0,
                            message: "ok",
                            data: null
                        });
                        return
                    }
                case "OPEN_URL":
                    {
                        m.key ? (me({
                            key: m.key,
                            query: m.query || void 0,
                            active: m.active || !1
                        }),
                        s(p, l.origin, {
                            success: !0,
                            message: "ok",
                            data: null
                        })) : s(p, l.origin, {
                            success: !1,
                            message: "key is required",
                            data: null
                        });
                        return
                    }
                case "RUN_SHORTCUTS":
                    {
                        o("Chat"),
                        n({
                            origin: l.origin,
                            taskId: p,
                            actions: m.actions || []
                        });
                        return
                    }
                case "CLOSE_SIDEBAR":
                    {
                        let y = ie()?.querySelector('.max-ai__action__set_variables_modal button[data-test-id="close-modal-button"]');
                        y && y.click(),
                        tr();
                        return
                    }
                case "OPEN_SIDEBAR":
                    Be()
                }
            }
        }
        ;
        return window.addEventListener("message", c),
        ()=>{
            window.removeEventListener("message", c)
        }
    }
    , [])
}
  , Qr = Gi;
var ut = A(D());
Oo();
No();
var Ge = A(D())
  , ai = A(Sn())
  , li = A(Cn());
var ii = A(Fi());
var M = A(D());
var Te = A(D());
var Vi = ({TooltipProps: o, ...t})=>{
    let {currentSidebarConversationType: e} = ce()
      , {currentAIProviderDetail: n, currentAIProviderModelDetail: r} = nr()
      , {t: i} = z(["common", "client"])
      , [u,a] = (0,
    Te.useState)(void 0);
    return (0,
    Te.useEffect)(()=>{
        if (e === "Chat" && n && r) {
            let s = i(n.label) !== n.label ? i(n.label) : n.label
              , c = i(r.title) !== r.title ? i(r.title) : r.title;
            a({
                title: `${s} (${c})`,
                provider: n.value,
                model: r.value
            })
        }
    }
    , [n, r, i, e]),
    Te.default.createElement(Te.default.Fragment, null, u ? Te.default.createElement(Fe, {
        ...o,
        title: u.title
    }, Te.default.createElement(F, {
        sx: {
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            alignSelf: "end"
        }
    }, u.provider ? Te.default.createElement(jn, {
        aiProviderType: u.provider,
        ...t
    }) : Te.default.createElement(we, {
        sx: {
            fontSize: t.size,
            ...t.sx
        }
    }))) : Te.default.createElement(F, {
        sx: {
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            alignSelf: "end"
        }
    }, Te.default.createElement(we, {
        sx: {
            fontSize: t.size,
            ...t.sx
        }
    })))
}
  , Zr = Vi;
var j = A(D());
var $i = o=>{
    let t = En()
      , {onChange: e} = o
      , {currentSidebarConversationMessages: n, currentSidebarConversationType: r} = ce()
      , i = J(he)
      , [,u] = Q(_t)
      , [,a] = Q(yo)
      , s = Io()
      , c = (0,
    j.useRef)("");
    (0,
    j.useEffect)(()=>{
        r === "Chat" && (c.current = Zn(n, y=>y.type === "ai")?.messageId || "")
    }
    , [n, r]),
    (0,
    j.useEffect)(()=>{
        i.open && a({
            lastAIMessageId: c.current
        })
    }
    , [i.open]),
    (0,
    j.useEffect)(()=>{
        u(y=>({
            ...y,
            lastOutput: s
        })),
        e?.(s)
    }
    , [s, i.open]);
    let l = (0,
    j.useRef)(null)
      , d = j.default.useRef(null)
      , m = (0,
    j.useCallback)(Rn(()=>{
        let y = l.current;
        y && (y.style.minHeight = `${d.current?.offsetHeight || 0}px`)
    }
    , 100), [])
      , p = (0,
    j.useCallback)(We(()=>{
        let y = l.current;
        y && (y.style.minHeight = `${(d.current?.offsetHeight || 0) + 1}px`)
    }
    , 100), []);
    return (0,
    j.useEffect)(()=>{
        setTimeout(()=>{
            d.current?.scrollTo({
                top: d.current.scrollHeight
            }),
            m(),
            p()
        }
        , 0)
    }
    , [s]),
    (0,
    j.useEffect)(()=>{
        let y = x=>{
            if ((x.metaKey || x.ctrlKey) && (x.stopPropagation(),
            x.key === "C" || x.key === "c" || x.key === "x" || x.key === "X")) {
                let S = window.getSelection();
                if (S && S.rangeCount > 0) {
                    let h = S.getRangeAt(0).toString() || S.toString();
                    h && (x.preventDefault(),
                    navigator.clipboard.writeText(h))
                }
            }
        }
        ;
        d.current?.addEventListener("keydown", y, !0)
    }
    , []),
    j.default.createElement(G, {
        ref: l,
        className: "chat-message--text max-ai__writing-message-box",
        whiteSpace: "pre-wrap",
        width: "100%",
        sx: {
            wordBreak: "break-word",
            borderBottomLeftRadius: 0,
            color: y=>y.palette.mode === "dark" ? "#FFFFFFDE" : "rgba(0,0,0,0.87)",
            "& .markdown-body": {
                userSelect: "text",
                maxHeight: "min(40vh, 320px)",
                overflowY: "auto",
                "*": {
                    fontFamily: '"Roboto","Helvetica","Arial",sans-serif!important'
                },
                "& p:last-child": {
                    mb: "1em"
                }
            }
        },
        component: "div"
    }, Bn(s) ? j.default.createElement(Ki, null) : null, j.default.createElement("div", {
        tabIndex: -1,
        ref: d,
        style: {
            textAlign: "left"
        },
        className: `markdown-body ${t.isDarkMode ? "markdown-body-dark" : ""}`
    }, j.default.createElement(Dr, null, s.replace(/^\s+/, ""))))
}
  , Ki = ()=>{
    let {t: o} = z(["common", "client"])
      , {currentSelection: t} = Le()
      , e = (0,
    j.useMemo)(()=>{
        if (t?.selectionElement?.editableElementSelectionText || t?.selectionElement?.selectionText) {
            let n = t?.selectionElement?.editableElementSelectionText || t?.selectionElement?.selectionText.trim().replace(/\u200B/g, "");
            return ((i,u)=>{
                if (i.length <= u)
                    return {
                        start: i,
                        end: ""
                    };
                let a = i.substring(i.length - u);
                return {
                    start: i.substring(0, i.length - u),
                    end: a
                }
            }
            )(n, 15)
        }
        return {
            start: "",
            end: ""
        }
    }
    , [t]);
    return !e.start && !e.end ? null : j.default.createElement(N, {
        sx: {
            width: "100%",
            display: "flex",
            flexDirection: "row"
        },
        fontSize: "12px",
        fontWeight: 400,
        color: "text.secondary"
    }, j.default.createElement("span", {
        style: {
            flexShrink: 0
        }
    }, o("client:floating_menu__draft_card__context__title"), ":", " "), j.default.createElement("span", {
        style: {
            display: "inline-block",
            overflow: "hidden",
            textOverflow: "ellipsis",
            whiteSpace: "nowrap",
            maxWidth: "100%"
        }
    }, e.start), j.default.createElement("span", {
        style: {
            flexShrink: 0,
            whiteSpace: "nowrap"
        }
    }, e.end))
}
  , ei = $i;
var nn = A(D());
var tn = A(ti())
  , ri = A(oi());
var E = A(D())
  , Ee = A(D());
var de = E.forwardRef(({label: o, icon: t, CustomRenderNode: e, onClick: n, isGroup: r, ...i},u)=>{
    let a = i;
    return E.createElement(F, {
        ...i,
        sx: {
            boxSizing: "border-box",
            borderRadius: "3px",
            height: "28px",
            fontSize: "14px",
            width: "100%",
            cursor: "pointer",
            "&.floating-context-menu-item--active": {
                bgcolor: s=>s.palette.mode === "dark" ? "rgba(255, 255, 255, 0.08)" : "rgba(55, 53, 47, 0.08)",
                "& .floating-context-menu-item__footer-icon": {
                    display: "flex"
                }
            },
            "& .floating-context-menu-item__footer-icon": {
                display: "none",
                flexShrink: 0
            },
            "& .floating-context-menu-item__footer-icon--active": {
                display: "flex"
            },
            "&:hover": {
                bgcolor: s=>s.palette.mode === "dark" ? "rgba(255, 255, 255, 0.08)" : "rgba(55, 53, 47, 0.08)",
                "& .floating-context-menu-item__footer-icon": {
                    display: "flex"
                }
            }
        },
        ref: u,
        component: "div",
        role: "menuitem",
        onClick: s=>{
            n?.(s),
            a?.onClick?.(s)
        }
    }, E.createElement(F, null, e || E.createElement(G, {
        direction: "row",
        spacing: 1,
        px: 1,
        alignItems: "center"
    }, E.createElement(ue, {
        size: 16,
        icon: t || "Empty",
        sx: {
            color: "primary.main",
            flexShrink: 0
        }
    }), E.createElement(N, {
        fontSize: 14,
        textAlign: "left",
        color: "text.primary",
        width: 0,
        noWrap: !0,
        flex: 1,
        lineHeight: "28px"
    }, o), r && E.createElement(tn.default, {
        sx: {
            ml: "auto",
            mr: 0,
            flexShrink: 0,
            color: s=>s.palette.mode === "dark" ? "#ffffff85" : "rgba(55, 53, 47, 0.45)",
            fontSize: 16
        }
    }))))
}
)
  , on = E.forwardRef(({label: o, disabled: t, menuItem: e, ...n},r)=>{
    let i = n
      , {t: u} = z(["prompt"])
      , a = J(Er)
      , [s,c] = Q(at)
      , l = (0,
    Ee.useMemo)(()=>{
        let p = e.id.replace(ht, "")
          , y = `prompt:${p}`;
        return u(y) !== p ? u(y) : e.text
    }
    , [e.text, u])
      , d = (0,
    Ee.useMemo)(()=>a.includes(e.id) || e.id === s.lastHoverContextMenuId, [a, s.lastHoverContextMenuId])
      , m = (0,
    Ee.useMemo)(()=>s.lastHoverContextMenuId === e.id && d, [d, s.lastHoverContextMenuId]);
    return E.createElement(F, {
        ...n,
        "data-id": e.id,
        className: `floating-context-menu-item ${d ? "floating-context-menu-item--active" : ""}`,
        tabIndex: d ? 0 : -1,
        sx: {
            display: "flex",
            alignItems: "center",
            flexDirection: "row",
            gap: 1,
            boxSizing: "border-box",
            px: 1,
            borderRadius: "3px",
            height: "28px",
            fontSize: "14px",
            width: "100%",
            cursor: "pointer",
            "&.floating-context-menu-item--active": {
                bgcolor: p=>p.palette.mode === "dark" ? "rgba(255, 255, 255, 0.08)" : "rgba(55, 53, 47, 0.08)",
                "& .floating-context-menu-item__footer-icon": {
                    display: "flex"
                }
            },
            "& .floating-context-menu-item__footer-icon": {
                display: "none",
                flexShrink: 0
            },
            "& .floating-context-menu-item__footer-icon--active": {
                display: "flex"
            },
            "&:hover": {
                bgcolor: p=>p.palette.mode === "dark" ? "rgba(255, 255, 255, 0.08)" : "rgba(55, 53, 47, 0.08)",
                "& .floating-context-menu-item__footer-icon": {
                    display: "flex"
                }
            }
        },
        ref: r,
        component: "div",
        role: "menuitem",
        onKeyDown: p=>{
            i?.onKeyDown?.(p),
            p.code === "Enter" && (c(y=>({
                ...y,
                selectedContextMenuId: e.id
            })),
            p.stopPropagation())
        }
        ,
        onClick: p=>{
            c(y=>({
                ...y,
                selectedContextMenuId: e.id
            })),
            i?.onClick?.(p)
        }
    }, e?.data?.icon && E.createElement(ue, {
        size: 16,
        icon: e.data.icon,
        sx: {
            color: "primary.main",
            flexShrink: 0
        }
    }), E.createElement(N, {
        fontSize: 14,
        textAlign: "left",
        color: "text.primary",
        width: 0,
        noWrap: !0,
        flex: 1,
        lineHeight: "28px"
    }, l), E.createElement("span", {
        className: "floating-context-menu-item__footer-icon " + (e.data.type === "group" ? "floating-context-menu-item__footer-icon--active" : "")
    }, e.data.type === "group" ? E.createElement(tn.default, {
        sx: {
            color: p=>p.palette.mode === "dark" ? "#ffffff85" : "rgba(55, 53, 47, 0.45)",
            fontSize: 16
        }
    }) : m && E.createElement(ri.default, {
        sx: {
            color: p=>p.palette.mode === "dark" ? "#ffffff85" : "rgba(55, 53, 47, 0.45)",
            fontSize: 16
        }
    })))
}
)
  , ni = E.forwardRef(({referenceElement: o, referenceElementOpen: t, zIndex: e, children: n, label: r, root: i, hoverOpen: u=!0, customOpen: a=!1, needAutoUpdate: s=!1, menuSx: c, defaultPlacement: l, defaultFallbackPlacements: d, onClickContextMenu: m, onClickReferenceElement: p, menuWidth: y=400, ...x},S)=>{
    let f = sr()
      , h = ar()
      , b = jo()
      , g = !b && e === 2147483601
      , [v,Z] = Q(at)
      , H = b != null
      , [X,xe] = E.useState(a ? t : !1);
    (0,
    Ee.useEffect)(()=>{
        setTimeout(()=>{
            xe(t)
        }
        , 1)
    }
    , [t]);
    let[_,I] = E.useState(g ? 1 : null)
      , R = J(he)
      , [k,ee] = E.useState(!1)
      , O = (0,
    Ee.useRef)(null)
      , W = (0,
    Ee.useRef)(null)
      , Y = E.useRef([])
      , He = E.useRef(E.Children.map(n, w=>E.isValidElement(w) ? w.props.label : null))
      , tt = l || (g ? "bottom-start" : "right-start")
      , Ro = d || (g ? ["bottom-start", "top-start", "right"] : ["right", "right-start", "right-end", "left", "left-start", "left-end"])
      , Nt = ()=>{
        I(null),
        W.current = null,
        O.current = null
    }
      , {x: Ve, y: vt, strategy: Do, refs: ot, context: De} = It({
        nodeId: h,
        open: X,
        onOpenChange: w=>{
            w || Nt(),
            !a && xe(w)
        }
        ,
        placement: tt,
        middleware: [io({
            mainAxis: g ? 4 : 0,
            alignmentAxis: g ? 0 : -4
        }), ro({
            fallbackPlacements: Ro
        }), so()],
        whileElementsMounted: s ? ao : void 0
    })
      , Ht = cr(De, {
        enabled: u && k,
        delay: {
            open: 75
        },
        handleClose: xr({
            restMs: 25,
            blockPointerEvents: !1
        })
    })
      , nt = uo(De, {
        event: "mousedown",
        toggle: !H || !k,
        ignoreMouse: H
    })
      , At = fr(De, {
        role: "menu"
    })
      , Wt = co(De)
      , $e = (0,
    Ee.useRef)(null)
      , kt = mr(De, {
        listRef: Y,
        activeIndex: _,
        nested: H,
        onNavigate(w) {
            let V = ()=>{
                let q = ie()?.querySelector(`#${Xe}`);
                q && q?.focus()
            }
              , L = b ? "[\u5B50\u7EA7]" : "[\u6839\u7EA7]"
              , le = $e.current?.key;
            if (le) {
                let q = !1
                  , Ce = null;
                W.current && (q = !0,
                Ce = vo(W.current));
                let te = [];
                Y.current?.forEach((Ie,zt)=>{
                    let Ae = Ie?.getAttribute("data-id");
                    Ae && te.push({
                        floatingUIId: Ie?.id?.replace(/:/g, "\\:") || "",
                        contextMenuId: Ae,
                        contextMenuIndex: zt
                    })
                }
                ),
                Z(Ie=>{
                    let zt = Ie.hoverContextMenuIdMap[h] || Ie.lastHoverContextMenuId || "";
                    q && Ce?.contextMenuId && (zt = Ce.contextMenuId);
                    let Ae = te.findIndex(ft=>ft.contextMenuId === zt);
                    if (le === "ArrowLeft")
                        return I(null),
                        V(),
                        {
                            ...Ie,
                            lastHoverContextMenuId: null,
                            hoverContextMenuIdMap: {
                                ...Ie.hoverContextMenuIdMap,
                                [h]: ""
                            }
                        };
                    if (le === "ArrowRight")
                        if (te.length > 0) {
                            let ft = te[0];
                            return I(ft.contextMenuIndex),
                            V(),
                            {
                                ...Ie,
                                lastHoverContextMenuId: ft.contextMenuId
                            }
                        } else
                            return I(null),
                            V(),
                            {
                                ...Ie,
                                lastHoverContextMenuId: null,
                                hoverContextMenuIdMap: {
                                    ...Ie.hoverContextMenuIdMap,
                                    [h]: ""
                                }
                            };
                    let xn = !1
                      , hn = $e.current?.target
                      , yn = hn?.getAttribute("data-lastid");
                    if (yn && (Ae = te.findIndex(ft=>ft.floatingUIId === yn),
                    hn.removeAttribute("data-lastid"),
                    xn = !0),
                    Ae === -1 && (b || (Ae = 0)),
                    Ae === -1)
                        return V(),
                        Ie;
                    let Ue = null;
                    return le === "ArrowDown" ? xn || q ? Ue = te[Ae] : te[Ae + 1] ? Ue = te[Ae + 1] : Ue = te[0] : le === "ArrowUp" && (te[Ae - 1] ? Ue = te[Ae - 1] : Ue = te[te.length - 1]),
                    Ue ? (I(Ue.contextMenuIndex),
                    V(),
                    {
                        ...Ie,
                        hoverContextMenuIdMap: {
                            ...Ie.hoverContextMenuIdMap,
                            [h || ""]: Ue.contextMenuId
                        },
                        lastHoverContextMenuId: Ue.contextMenuId
                    }) : (V(),
                    Ie)
                }
                ),
                $e.current = null
            }
        },
        loop: !0,
        virtual: !0
    })
      , C = gr(De, {
        enabled: X,
        listRef: He,
        onMatch: X ? I : void 0,
        activeIndex: _
    })
      , {getReferenceProps: P, getFloatingProps: K, getItemProps: _e} = po([Ht, nt, At, Wt, kt, C]);
    E.useEffect(()=>{
        if (!f)
            return;
        function w() {
            a || xe(!1)
        }
        function V(L) {
            L.nodeId !== h && L.parentId === b && xe(!1)
        }
        return f.events.on("click", w),
        f.events.on("menuopen", V),
        ()=>{
            f.events.off("click", w),
            f.events.off("menuopen", V)
        }
    }
    , [f, h, b, a]),
    E.useEffect(()=>{
        X && f && f.events.emit("menuopen", {
            parentId: b,
            nodeId: h
        })
    }
    , [f, X, h, b]),
    E.useEffect(()=>{
        function w({pointerType: L}) {
            L !== "touch" && ee(!0)
        }
        function V() {
            ee(!1)
        }
        return window.addEventListener("pointermove", w, {
            once: !0,
            capture: !0
        }),
        window.addEventListener("keydown", V, !0),
        ()=>{
            window.removeEventListener("pointermove", w, {
                capture: !0
            }),
            window.removeEventListener("keydown", V, !0)
        }
    }
    , [k]),
    (0,
    Ee.useEffect)(()=>{
        let w = !1;
        return g && v.lastHoverContextMenuId && n && setTimeout(()=>{
            w || I(V=>{
                let L = n.findIndex(le=>le?.key === v.lastHoverContextMenuId);
                return L !== -1 && V === null ? L : V
            }
            )
        }
        , 0),
        ()=>{
            w = !0
        }
    }
    , [v.lastHoverContextMenuId, n]);
    let ne = dr([ot.setReference, S])
      , Ke = (0,
    Ee.useCallback)(()=>{
        let w = v.lastHoverContextMenuId;
        if (w) {
            let V = ie()?.querySelector(`[data-id="${w}"]`);
            V && V.dispatchEvent(new KeyboardEvent("keydown",{
                key: "Enter",
                bubbles: !0,
                cancelable: !0,
                code: "Enter",
                keyCode: 13
            }))
        }
    }
    , [v]);
    return (0,
    Ee.useEffect)(()=>{
        R.open || (Nt(),
        Z(w=>({
            ...w,
            hoverContextMenuIdMap: {},
            lastHoverContextMenuId: null
        })))
    }
    , [R.open]),
    E.createElement(lr, {
        id: h
    }, o ? E.isValidElement(o) && E.cloneElement(o, {
        ...P({
            ...x,
            className: `${H ? "MenuItem" : "RootMenu"}`,
            onClick(w) {
                w.stopPropagation(),
                p?.(w)
            },
            onKeyDownCapture(w) {
                if (w.key === "Enter" && !b) {
                    Ke();
                    return
                }
                if (w.key === "ArrowDown" || w.key === "ArrowUp" || w.key === "ArrowLeft" || w.key === "ArrowRight") {
                    if (W.current = null,
                    w.key === "ArrowLeft") {
                        if (!b && O.current) {
                            let L = vo(O.current);
                            L?.parentDropdownSelectedItem && (L.dropdownSelectedItem.focus(),
                            L.dropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{
                                key: w.key,
                                bubbles: !0,
                                cancelable: !0
                            })),
                            L.parentDropdownSelectedItem && L.id && (L.parentDropdownSelectedItem.setAttribute("data-lastid", L.id),
                            L.parentDropdownSelectedItem.focus(),
                            L.parentDropdownSelectedItem.classList.contains("RootMenu") ? O.current = null : O.current = L.parentDropdownSelectedItem,
                            L.parentDropdownSelectedItem.dispatchEvent(new KeyboardEvent("keydown",{
                                key: "ArrowDown",
                                bubbles: !0,
                                cancelable: !0
                            }))))
                        }
                        return
                    } else if (w.key === "ArrowRight" && !b && _ !== null) {
                        let L = Y.current[_];
                        if (O.current) {
                            let le = O.current?.getAttribute("aria-controls")?.replace(/:/g, "\\:")
                              , q = ie()?.querySelector(`#${le}`);
                            if (q) {
                                let Ce = q.getAttribute("aria-activedescendant")?.replace(/:/g, "\\:")
                                  , te = q.querySelector(`#${Ce}`);
                                te.id && te.getAttribute("aria-haspopup") && (L = te)
                            }
                        }
                        L && L.getAttribute("aria-haspopup") === "menu" && (L.focus(),
                        L.dispatchEvent(new KeyboardEvent("keydown",{
                            key: w.key,
                            bubbles: !0,
                            cancelable: !0
                        })),
                        O.current = L);
                        return
                    } else if (O.current) {
                        O.current.focus(),
                        O.current.dispatchEvent(new KeyboardEvent("keydown",{
                            key: w.key,
                            bubbles: !0,
                            cancelable: !0
                        }));
                        return
                    }
                    ie()?.querySelector(`#${Xe}`)?.focus(),
                    $e.current = w
                }
            },
            ...H && {
                role: "menuitem"
            },
            ref: ne
        })
    }) : E.createElement($, {
        ref: ne,
        ...P({
            ...x,
            className: `${H ? "MenuItem" : "RootMenu"}`,
            onClick(w) {
                w.stopPropagation()
            },
            ...H && {
                role: "menuitem"
            }
        }),
        startIcon: E.createElement(we, {
            sx: {
                fontSize: 16,
                color: "inherit"
            }
        }),
        variant: "outlined"
    }, r || "Use ChatGPT"), E.createElement(lo, {
        root: i
    }, X && E.Children.count(n) && E.createElement(pr, {
        context: De,
        modal: !1,
        initialFocus: -1,
        visuallyHiddenDismiss: !0
    }, E.createElement(F, {
        sx: {
            zIndex: (e || 0) + 1,
            display: "flex",
            flexDirection: "column",
            p: .5,
            outline: "none!important",
            width: y,
            maxHeight: 327,
            boxSizing: "border-box",
            overflowY: "auto",
            border: "1px solid",
            borderColor: "customColor.borderColor",
            bgcolor: "background.paper",
            borderRadius: "6px",
            boxShadow: "rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px",
            "& *": {
                outline: "none!important"
            },
            "&:has(.max-ai--popper-wrapper)": {
                overflowY: "unset"
            },
            ...c
        },
        component: "div",
        ref: ot.setFloating,
        className: "Menu",
        style: {
            position: Do,
            top: vt ?? 0,
            left: Ve ?? 0
        },
        ...K()
    }, E.Children.map(n, (w,V)=>E.isValidElement(w) && E.cloneElement(w, _e({
        tabIndex: _ === V ? 0 : -1,
        ref(L) {
            Y.current[V] = L
        },
        onMouseDown(L) {
            m && (f?.events.emit("click"),
            w.props?.menuItem?.data?.type === "shortcuts" && m?.(w.props.menuItem))
        },
        onClick(L) {
            m || (w.props.onClick?.(L),
            f?.events.emit("click"))
        },
        onKeyDownCapture(L) {
            $e.current = L
        },
        onMouseEnter(L) {
            L.stopPropagation(),
            L.preventDefault();
            let le = L.currentTarget;
            if (le.getAttribute("data-id")) {
                O.current = le;
                let q = vo(le);
                if ((q?.id || q?.contextMenuId) && q.expandedSiblingMenuItem) {
                    if (q.expandedSiblingMenuItem?.getAttribute("data-id") === q.contextMenuId)
                        return;
                    let Ce = vo(q.expandedSiblingMenuItem);
                    if (Ce?.dropdownSelectedItem) {
                        let te = new KeyboardEvent("keydown",{
                            key: "ArrowLeft",
                            bubbles: !0,
                            cancelable: !0
                        });
                        W.current = Ce.dropdownSelectedItem,
                        Ce.dropdownSelectedItem.focus(),
                        Ce.dropdownSelectedItem.dispatchEvent(te),
                        q.expandedSiblingMenuItem.setAttribute("data-lastid", q.contextMenuId),
                        q.expandedSiblingMenuItem.classList.contains("RootMenu") ? O.current = null : O.current = Ce.parentDropdownSelectedItem,
                        q.expandedSiblingMenuItem.focus(),
                        q.expandedSiblingMenuItem.dispatchEvent(new KeyboardEvent("keydown",{
                            key: "ArrowDown",
                            bubbles: !0,
                            cancelable: !0
                        }))
                    }
                }
                if (q?.id) {
                    let Ce = new KeyboardEvent("keydown",{
                        key: "ArrowDown",
                        bubbles: !0,
                        cancelable: !0
                    });
                    W.current = le,
                    q.keydownEmitElement?.dispatchEvent(Ce);
                    let te = new KeyboardEvent("keydown",{
                        key: "ArrowRight",
                        bubbles: !0,
                        cancelable: !0
                    });
                    W.current = le,
                    le.dispatchEvent(te)
                } else if (q?.contextMenuId) {
                    let Ce = new KeyboardEvent("keydown",{
                        key: "ArrowDown",
                        bubbles: !0,
                        cancelable: !0
                    });
                    W.current = le,
                    le.dispatchEvent(Ce)
                }
            }
        }
    })))))))
}
)
  , Oe = E.forwardRef((o,t)=>jo() === null ? E.createElement(ur, null, E.createElement(ni, {
    ...o,
    ref: t
})) : E.createElement(ni, {
    ...o,
    ref: t
}))
  , vo = o=>{
    let t = ie();
    if (!o || !t)
        return null;
    let e = o.getAttribute("id")?.replace(/:/g, "\\:") || ""
      , n = o.getAttribute("data-id") || ""
      , r = o.getAttribute("aria-haspopup") === "menu"
      , i = t.querySelector(`div[aria-haspopup="menu"][aria-activedescendant="${e}"]`)
      , u = i?.getAttribute("aria-controls")?.replace(/:/g, "\\:")
      , a = u ? t.querySelector(`#${u}`) : null
      , s = o.getAttribute("aria-controls")?.replace(/:/g, "\\:")
      , c = s ? t.querySelector(`#${s}`) : null
      , l = null;
    c && !l && (l = c.querySelector('.floating-context-menu-item--active:not([aria-haspopup="menu"])'),
    l || (l = c.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])')));
    let d = o.parentElement?.querySelector('.floating-context-menu-item:not([aria-haspopup="menu"])')
      , m = o.parentElement?.querySelector('.floating-context-menu-item[aria-expanded="true"]');
    return {
        id: e,
        contextMenuId: n,
        isMenu: r,
        parentDropdownSelectedItem: i,
        parentDropdown: a,
        dropdownMenu: c,
        dropdownSelectedItem: l,
        keydownEmitElement: d,
        expandedSiblingMenuItem: m
    }
}
;
var T = A(D());
var Ze = A(D());
var ts = o=>{
    let t = ie() || document.body
      , {children: e, content: n, boxSx: r, onClick: i, PopperProps: u, hoverOpen: a, stopEvent: s=!0} = o
      , [c,l] = Ze.default.useState(null)
      , d = (0,
    Ze.useRef)(Vt())
      , m = f=>{
        s && (f.stopPropagation(),
        f.preventDefault()),
        l(c ? null : f.currentTarget),
        i?.(f)
    }
      , p = f=>{
        a && l(f.currentTarget)
    }
      , y = f=>{
        a && l(null)
    }
      , x = !!c
      , S = x ? d.current : void 0;
    return Ze.default.createElement(Ze.default.Fragment, null, Ze.default.createElement(F, {
        component: "div",
        onMouseEnter: p,
        onMouseLeave: y,
        onClick: m,
        onMouseDown: f=>{
            s && (f.stopPropagation(),
            f.preventDefault())
        }
        ,
        onMouseUp: f=>{
            s && (f.stopPropagation(),
            f.preventDefault())
        }
        ,
        sx: {
            ...r
        }
    }, e), Ze.default.createElement(Kn, {
        disablePortal: !0,
        id: S,
        open: x,
        anchorEl: c,
        container: t,
        style: {
            zIndex: 2147483630
        },
        className: "max-ai--popper-wrapper",
        ...u
    }, n))
}
  , rn = ts;
var Ao = A(D());
var sn = o=>{
    let {t} = z(["common", "client"])
      , {sx: e, placement: n, ButtonProps: r, iconSize: i=16, icon: u="Close"} = o
      , [,a] = Q(he)
      , s = re(Je);
    return Ao.default.createElement(Fe, {
        title: t("client:floating_menu__button__hide_menu__until_next_visit"),
        floatingMenuTooltip: !0,
        placement: n
    }, Ao.default.createElement($, {
        size: "small",
        variant: "text",
        sx: {
            width: 32,
            height: 32,
            minWidth: "unset",
            color: "text.primary",
            ...e
        },
        onClick: async()=>{
            a({
                open: !1,
                rootRect: null
            }),
            s(c=>({
                ...c,
                closeBeforeRefresh: !0
            }))
        }
        ,
        ...r
    }, Ao.default.createElement(ue, {
        icon: u,
        sx: {
            color: "inherit",
            fontSize: i
        }
    })))
}
;
var ve = A(D());
var os = ({liteMode: o})=>{
    let {t} = z(["common", "client"]);
    return ve.default.createElement(ve.default.Fragment, null, o ? ve.default.createElement(F, {
        sx: {
            borderRadius: "4px",
            bgcolor: e=>e.palette.mode === "dark" ? "rgb(7, 19, 24)" : "rgb(229, 246, 253)",
            color: e=>e.palette.mode === "dark" ? "rgb(184, 231, 251)" : "rgb(1, 67, 97)",
            p: 2,
            overflow: "hidden"
        }
    }, ve.default.createElement(G, {
        spacing: 1,
        alignItems: "center"
    }, ve.default.createElement(N, {
        fontSize: 14,
        color: "text.primary"
    }, t("client:floating_menu__button__hide_menu__this_site__tooltip__description")), ve.default.createElement("img", {
        src: "https://www.maxai.me/assets/chrome-extension/settings-entry-small.png",
        alt: "settings-entry",
        width: 200,
        height: 80
    }))) : ve.default.createElement(Vn, {
        icon: ve.default.createElement(ve.default.Fragment, null),
        sx: {
            mt: 1,
            mb: 2
        }
    }, ve.default.createElement(G, {
        spacing: 1
    }, ve.default.createElement(N, {
        fontSize: 14,
        color: "text.primary"
    }, t("client:floating_menu__button__hide_menu__this_site__tooltip__description")), ve.default.createElement("img", {
        src: "https://www.maxai.me/assets/chrome-extension/settings-entry.png",
        alt: "settings-entry",
        width: 466,
        height: 121
    }))))
}
  , an = os;
var ln = o=>{
    let {sx: t, placement: e} = o
      , {t: n} = z(["common", "client"])
      , [r,i] = (0,
    T.useState)(!0)
      , u = re(Je)
      , {updateButtonSettingsWithDomain: a, toggleButtonSettings: s} = On()
      , {hideRangy: c} = Le()
      , [,l] = Q(he)
      , [d,m] = (0,
    T.useState)(null)
      , [p,y] = (0,
    T.useState)(!1);
    return (0,
    T.useEffect)(()=>{
        if (d)
            return;
        let x = ie();
        x && m(x),
        i(!1)
    }
    , []),
    T.default.createElement(Dt, {
        loading: r
    }, d && T.default.createElement(Oe, {
        defaultPlacement: "bottom-start",
        defaultFallbackPlacements: ["top-start"],
        hoverOpen: !0,
        zIndex: 2147483610,
        label: "",
        root: d,
        menuSx: {
            width: 240
        },
        referenceElement: T.default.createElement(F, {
            sx: {
                zIndex: 2,
                alignSelf: "end",
                position: "relative",
                display: "flex",
                bgcolor: p ? "background.paper" : "transparent",
                borderRadius: p ? 0 : "0 14px 14px 0",
                transition: p ? "background-color 0s ease-out" : "background-color 0.1s ease-in-out",
                width: "34px",
                "&::before": {
                    content: '""',
                    position: "absolute",
                    left: 0,
                    height: "28px",
                    bgcolor: "background.paper",
                    width: "21px"
                }
            }
        }, T.default.createElement($, {
            onMouseEnter: ()=>{
                y(!0)
            }
            ,
            onMouseLeave: ()=>{
                y(!1)
            }
            ,
            size: "small",
            variant: "text",
            sx: {
                padding: "5px 8px",
                color: "inherit",
                minWidth: "unset",
                ...t
            }
        }, T.default.createElement(ue, {
            icon: "More",
            sx: {
                color: x=>x.palette.mode === "dark" ? "rgba(255,255,255,.87)" : "rgba(0,0,0,.6)",
                fontSize: "18px"
            }
        })), T.default.createElement(sn, {
            ButtonProps: {
                onMouseEnter: ()=>{
                    y(!0)
                }
                ,
                onMouseLeave: ()=>{
                    y(!1)
                }
            },
            icon: p ? "Close" : "More",
            iconSize: 18,
            sx: {
                zIndex: 1,
                left: p ? "100%" : 0,
                transition: "left 0.1s ease-in-out",
                width: "34px",
                height: "28px",
                padding: "5px 8px",
                borderRadius: "0 14px 14px 0",
                right: "-100%",
                position: "absolute",
                bgcolor: "background.paper",
                color: x=>x.palette.mode === "dark" ? "rgba(255,255,255,.87)" : "rgba(0,0,0,.6)",
                "&:hover": {
                    bgcolor: x=>x.palette.mode === "dark" ? "rgb(61,61,61)" : "rgb(224,224,224)"
                }
            },
            placement: e
        }))
    }, T.default.createElement(Oe, {
        defaultPlacement: "right-start",
        defaultFallbackPlacements: ["right", "left", "bottom", "top"],
        root: d,
        referenceElement: T.default.createElement(de, {
            isGroup: !0,
            icon: "Delete",
            label: n("client:floating_menu__button__clear_suggested")
        }),
        menuSx: {
            width: 320
        },
        hoverOpen: !0,
        zIndex: 2147483611,
        label: ""
    }, T.default.createElement(de, {
        label: n("client:floating_menu__button__clear_suggested__this_site"),
        onClick: async()=>{
            await Ye.getMediator("textSelectPopupButton").clearCache()
        }
    }), T.default.createElement(de, {
        label: n("client:floating_menu__button__clear_suggested__all_sites"),
        onClick: async()=>{
            await Ye.getMediator("textSelectPopupButton").clearAllHostCache()
        }
    })), T.default.createElement(Oe, {
        defaultPlacement: "right-start",
        defaultFallbackPlacements: ["right", "left", "bottom", "top"],
        root: d,
        referenceElement: T.default.createElement(de, {
            isGroup: !0,
            icon: "VisibilityOff",
            label: n("client:floating_menu__button__hide_menu")
        }),
        menuSx: {
            width: 320
        },
        hoverOpen: !0,
        zIndex: 2147483611,
        label: ""
    }, T.default.createElement(de, {
        onClick: ()=>{
            l({
                open: !1,
                rootRect: null
            }),
            u(x=>({
                ...x,
                closeBeforeRefresh: !0
            }))
        }
        ,
        label: n("client:floating_menu__button__hide_menu__until_next_visit")
    }), T.default.createElement(de, {
        CustomRenderNode: T.default.createElement(rn, {
            PopperProps: {
                placement: "top"
            },
            onClick: x=>{
                x.stopPropagation(),
                x.preventDefault()
            }
            ,
            content: T.default.createElement(en, {
                sx: {
                    p: 3,
                    width: 288,
                    boxSizing: "border-box",
                    cursor: "auto"
                }
            }, T.default.createElement(G, {
                spacing: 1
            }, T.default.createElement(N, {
                textAlign: "center",
                fontWeight: "600",
                fontSize: "16px",
                color: "text.primary"
            }, n("client:floating_menu__button__hide_menu__this_site__tooltip__title")), T.default.createElement(an, {
                liteMode: !0
            }), T.default.createElement(F, null), T.default.createElement($, {
                variant: "outlined",
                color: "primary",
                onClick: async()=>{
                    await a("textSelectPopupButton"),
                    l({
                        open: !1,
                        rootRect: null
                    })
                }
            }, n("client:floating_menu__button__hide_menu__this_site__tooltip__confirm")), T.default.createElement($, {
                variant: "contained",
                color: "primary",
                onClick: ()=>{
                    l({
                        open: !1,
                        rootRect: null
                    }),
                    c()
                }
            }, n("common:cancel"))))
        }, T.default.createElement(G, {
            direction: "row",
            spacing: 1,
            px: 1,
            alignItems: "center"
        }, T.default.createElement(ue, {
            size: 16,
            icon: "Empty",
            sx: {
                color: "primary.main",
                flexShrink: 0
            }
        }), T.default.createElement(N, {
            fontSize: 14,
            textAlign: "left",
            color: "text.primary",
            width: 0,
            noWrap: !0,
            flex: 1,
            lineHeight: "28px"
        }, n("client:floating_menu__button__hide_menu__this_site"))))
    }), T.default.createElement(de, {
        CustomRenderNode: T.default.createElement(rn, {
            PopperProps: {
                placement: "top"
            },
            onClick: x=>{
                x.stopPropagation(),
                x.preventDefault()
            }
            ,
            content: T.default.createElement(en, {
                sx: {
                    p: 3,
                    width: 288,
                    boxSizing: "border-box",
                    cursor: "auto"
                }
            }, T.default.createElement(G, {
                spacing: 1
            }, T.default.createElement(N, {
                fontSize: "16px",
                color: "text.primary",
                textAlign: "center",
                fontWeight: "600"
            }, n("client:floating_menu__button__hide_menu__all_sites__tooltip__title")), T.default.createElement(an, {
                liteMode: !0
            }), T.default.createElement(F, null), T.default.createElement($, {
                variant: "outlined",
                color: "primary",
                onClick: async()=>{
                    await s("textSelectPopupButton", !1),
                    l({
                        open: !1,
                        rootRect: null
                    })
                }
            }, n("client:floating_menu__button__hide_menu__all_sites__tooltip__confirm")), T.default.createElement($, {
                variant: "contained",
                color: "primary",
                onClick: ()=>{
                    l({
                        open: !1,
                        rootRect: null
                    }),
                    c()
                }
            }, n("common:cancel"))))
        }, T.default.createElement(G, {
            direction: "row",
            spacing: 1,
            px: 1,
            alignItems: "center"
        }, T.default.createElement(ue, {
            size: 16,
            icon: "Empty",
            sx: {
                color: "primary.main",
                flexShrink: 0
            }
        }), T.default.createElement(N, {
            fontSize: 14,
            textAlign: "left",
            color: "text.primary",
            width: 0,
            noWrap: !0,
            flex: 1,
            lineHeight: "28px"
        }, n("client:floating_menu__button__hide_menu__all_sites"))))
    }), T.default.createElement(de, {
        label: n("client:floating_menu__button__menu_settings"),
        icon: "Settings",
        onClick: ()=>{
            me({
                key: "options",
                query: "#/mini-menu"
            })
        }
    })), T.default.createElement(de, {
        onClick: ()=>{
            me({
                key: "options"
            })
        }
        ,
        label: n("common:settings"),
        icon: "Settings"
    })))
}
;
var ko = A(D());
var Ot = o=>{
    let {t} = z(["common", "client"])
      , {hideRangy: e} = Le()
      , [,n] = Q(he)
      , {chatBoxShortCutKey: r} = Qe();
    return ko.default.createElement(Fe, {
        description: r,
        title: t("client:floating_menu__button__switch_to_sidebar"),
        placement: "bottom",
        ...o.TooltipProps
    }, ko.default.createElement($, {
        sx: {
            ml: "0px!important",
            height: "24px",
            flexShrink: 0,
            alignSelf: "end",
            minWidth: "unset",
            padding: "6px 5px"
        },
        className: "max-ai__actions__button--toggle-sidebar",
        variant: "text",
        onClick: ()=>{
            Mr(),
            e(),
            n({
                open: !1,
                rootRect: null
            }),
            or() || Be()
        }
    }, ko.default.createElement($n, {
        sx: {
            fontSize: "16px",
            color: "text.primary"
        }
    })))
}
;
var fe = A(D());
var un = o=>{
    let {sx: t} = o
      , {t: e} = z(["common", "client"])
      , [n,r] = (0,
    fe.useState)(!0)
      , [i,u] = (0,
    fe.useState)(null);
    return (0,
    fe.useEffect)(()=>{
        if (i)
            return;
        let a = ie();
        a && u(a),
        r(!1)
    }
    , []),
    fe.default.createElement(Dt, {
        loading: n
    }, i && fe.default.createElement(Oe, {
        defaultPlacement: "bottom-start",
        defaultFallbackPlacements: ["top-start"],
        hoverOpen: !0,
        zIndex: 2147483610,
        label: "",
        root: i,
        menuSx: {
            width: 240
        },
        referenceElement: fe.default.createElement(F, {
            sx: {
                alignSelf: "end"
            }
        }, fe.default.createElement($, {
            size: "small",
            variant: "text",
            sx: {
                width: 32,
                height: 32,
                color: "inherit",
                minWidth: "unset",
                ...t
            }
        }, fe.default.createElement(ue, {
            icon: "More",
            sx: {
                color: "text.primary",
                fontSize: 16
            }
        })))
    }, fe.default.createElement(de, {
        onClick: ()=>{
            me({
                key: "options",
                query: "#/my-own-prompts"
            })
        }
        ,
        label: e("client:floating_menu__button__manage_my_own_prompt"),
        icon: "DefaultIcon"
    }), fe.default.createElement(Oe, {
        defaultPlacement: "right-start",
        defaultFallbackPlacements: ["right", "left", "bottom", "top"],
        root: i,
        referenceElement: fe.default.createElement(de, {
            isGroup: !0,
            icon: "Delete",
            label: e("client:floating_menu__button__clear_suggested")
        }),
        menuSx: {
            width: 320
        },
        hoverOpen: !0,
        zIndex: 2147483611,
        label: ""
    }, fe.default.createElement(de, {
        label: e("client:floating_menu__button__clear_suggested__this_site"),
        onClick: async()=>{
            await Ye.getMediator("textSelectPopupButton").clearCache()
        }
    }), fe.default.createElement(de, {
        label: e("client:floating_menu__button__clear_suggested__all_sites"),
        onClick: async()=>{
            await Ye.getMediator("textSelectPopupButton").clearAllHostCache()
        }
    })), fe.default.createElement(de, {
        onClick: ()=>{
            me({
                key: "options"
            })
        }
        ,
        label: e("common:settings"),
        icon: "Settings"
    })))
}
;
var oe = A(D());
var cn = ()=>{
    let o = J(Pe)
      , t = (0,
    oe.useRef)(!1)
      , e = (0,
    oe.useMemo)(()=>!!(o.loading && o.writingMessage?.text), [o.loading, o.writingMessage])
      , {stopGenerateMessage: n, reGenerate: r} = Ar()
      , i = (0,
    oe.useCallback)(async a=>{
        a === "s" && (t.current = !1,
        await n()),
        a === "r" && (t.current = !0,
        await n())
    }
    , [n])
      , u = (0,
    oe.useRef)(r);
    return (0,
    oe.useEffect)(()=>{
        u.current = r
    }
    , [r]),
    (0,
    oe.useEffect)(()=>{
        if (!e)
            return;
        let a = async s=>{
            let c = s.key;
            fo() && ["r", "s", "o", "c"].includes(c) && (s.preventDefault(),
            s.stopPropagation(),
            await i(c))
        }
        ;
        return window.addEventListener("keydown", a),
        ()=>{
            window.removeEventListener("keydown", a)
        }
    }
    , [e, i]),
    e ? oe.default.createElement(G, {
        direction: "row",
        spacing: 1,
        sx: {
            ml: "auto!important",
            "& .usechatgpt-floating-menu__button__shortcut": {
                fontSize: "12px",
                opacity: .7,
                ml: "4px"
            }
        }
    }, oe.default.createElement($, {
        sx: {
            height: "24px"
        },
        variant: "text",
        onClick: async()=>{
            await i("r")
        }
    }, oe.default.createElement(N, {
        component: "span",
        fontSize: "14px",
        color: "primary.main"
    }, "Try again", oe.default.createElement("span", {
        className: "usechatgpt-floating-menu__button__shortcut"
    }, "R"))), oe.default.createElement($, {
        sx: {
            height: "24px"
        },
        variant: "text",
        onClick: async()=>{
            await i("s")
        }
    }, oe.default.createElement(N, {
        component: "span",
        fontSize: "14px",
        color: "primary.main"
    }, "Stop", oe.default.createElement("span", {
        className: "usechatgpt-floating-menu__button__shortcut"
    }, "S"))), oe.default.createElement(Ot, null)) : oe.default.createElement(oe.default.Fragment, null)
}
;
var pe = A(D());
var pn = (0,
pe.forwardRef)((o,t)=>{
    let {menuItem: e, root: n, referenceElement: r, referenceElementOpen: i, rootMenu: u, customOpen: a, onClickContextMenu: s, menuWidth: c, ...l} = o
      , {t: d} = z(["prompt"])
      , m = (0,
    pe.useMemo)(()=>d(`prompt:${e.id}`) !== e.id ? d(`prompt:${e.id}`) : e.text, [e.text, d])
      , p = (0,
    pe.useCallback)(y=>d(`prompt:${y.id}`) !== y.id ? d(`prompt:${y.id}`) : y.text, [d]);
    return e.data.type === "group" ? pe.default.createElement(Oe, {
        zIndex: o.zIndex,
        ref: t,
        root: n,
        label: m,
        menuWidth: c,
        onClickContextMenu: s,
        referenceElement: pe.default.createElement(on, {
            ...l,
            label: m,
            menuItem: e
        })
    }, e.children.map((y,x)=>pe.default.createElement(pn, {
        ...l,
        root: n,
        key: y.id,
        menuItem: y,
        label: p(y)
    }))) : pe.default.createElement(on, {
        ...l,
        menuItem: e,
        ref: t,
        label: m
    })
}
)
  , ns = o=>{
    let {root: t, referenceElement: e, referenceElementOpen: n, menuList: r, customOpen: i, needAutoUpdate: u, defaultPlacement: a, defaultFallbackPlacements: s, onClickContextMenu: c, menuWidth: l, onClickReferenceElement: d, hoverOpen: m, ...p} = o
      , {t: y} = z(["prompt"])
      , x = (0,
    pe.useMemo)(()=>{
        let S = [];
        return r.forEach((f,h)=>{
            let b = y(`prompt:${f.id}`) !== f.id ? y(`prompt:${f.id}`) : f.text;
            f.data.type === "group" ? (h > 0 && S.push(pe.default.createElement(F, {
                key: f.id + "_group_spector",
                "aria-disabled": !0,
                onClick: g=>{
                    g.stopPropagation(),
                    g.preventDefault()
                }
                ,
                component: "div",
                sx: {
                    pointerEvents: "none",
                    borderTop: "1px solid",
                    borderColor: "customColor.borderColor",
                    my: 1
                }
            })),
            S.push(pe.default.createElement(F, {
                key: f.id + "_group_name",
                component: "div",
                "aria-disabled": !0,
                sx: {
                    display: "flex",
                    justifyContent: "flex-start",
                    alignItems: "center",
                    width: "100%",
                    boxSizing: "border-box",
                    direction: "row",
                    px: 1,
                    pointerEvents: "none"
                },
                onClick: g=>{
                    g.stopPropagation(),
                    g.preventDefault()
                }
            }, pe.default.createElement(N, {
                textAlign: "left",
                fontSize: 12,
                color: "text.secondary"
            }, b))),
            f.children.forEach((g,v)=>{
                S.push(pe.default.createElement(pn, {
                    menuWidth: l,
                    onClickContextMenu: c,
                    zIndex: 2147483602,
                    ...p,
                    key: g.id,
                    label: "",
                    menuItem: g,
                    root: t
                }))
            }
            )) : S.push(pe.default.createElement(pn, {
                menuWidth: l,
                onClickContextMenu: c,
                key: f.id,
                label: "",
                menuItem: f,
                root: t
            }))
        }
        ),
        S
    }
    , [r, y]);
    return pe.default.createElement(Oe, {
        zIndex: 2147483601,
        label: "",
        root: t,
        customOpen: i,
        needAutoUpdate: u,
        referenceElement: e,
        referenceElementOpen: n,
        defaultPlacement: a,
        defaultFallbackPlacements: s,
        onClickContextMenu: c,
        onClickReferenceElement: d,
        hoverOpen: m,
        menuWidth: l
    }, x)
}
  , Po = ns;
var rs = []
  , is = !0
  , si = o=>{
    let {root: t} = o
      , {t: e} = z(["common", "client"])
      , {palette: n} = bn()
      , {currentSelectionRef: r} = Le()
      , i = (0,
    M.useRef)(Me())
      , u = J(Pe)
      , a = re(qe)
      , {currentSidebarConversationType: s, updateSidebarConversationType: c} = ce()
      , [l,d] = Q(he)
      , m = Io()
      , {isLogin: p} = Qt()
      , y = J(Yn)
      , [x,S] = Q(_t)
      , f = (0,
    M.useCallback)(()=>{
        let C = r.current?.activeElement || r.current?.selectionElement?.target;
        return C && Xn()?.contains(C)
    }
    , [])
      , h = (0,
    M.useMemo)(()=>x.lastOutput, [x.lastOutput])
      , [b,g] = Q(at)
      , [v,Z] = (0,
    M.useState)([])
      , H = (0,
    M.useMemo)(()=>{
        if (l.rootRect) {
            let C = Math.max(l.rootRect?.width || 0, Go - 32);
            return C > 1280 ? 1280 : C
        }
        return Go - 32
    }
    , [l.rootRect])
      , X = (0,
    M.useMemo)(()=>{
        let C = "bottom-start"
          , P = "bottom-start";
        if (l.rootRect && H) {
            let K = yr(l.rootRect, H, 400);
            K.y > l.rootRect.top ? (C = "bottom-start",
            P = "bottom-start") : K.y < l.rootRect.top && (C = "top-start",
            P = "top-start"),
            K.x > l.rootRect.left + 300 ? C = "right-start" : K.x < l.rootRect.left - 300 && (C = "left-start")
        }
        return {
            inputPlacement: C,
            contextMenuPlacement: P
        }
    }
    , [l.rootRect, H])
      , {x: xe, y: _, strategy: I, refs: R, context: k} = It({
        open: l.open,
        onOpenChange: C=>{
            d(P=>({
                ...P,
                open: C
            }))
        }
        ,
        placement: X.inputPlacement,
        middleware: Sr,
        whileElementsMounted: ao
    })
      , ee = uo(k)
      , O = co(k, {})
      , {getFloatingProps: W} = po([O, ee])
      , [Y,He] = (0,
    M.useState)("")
      , tt = (0,
    M.useRef)(null)
      , {setShortCuts: Ro, runShortCuts: Nt, loading: Ve, reGenerate: vt, shortCutsEngineRef: Do} = ye("")
      , {contextMenuList: ot, originContextMenuList: De} = xo("textSelectPopupButton", Y)
      , Ht = _r()
      , nt = (0,
    M.useMemo)(()=>Ve ? rs : h ? Ht : ot, [Ve, ot, h, Ht]);
    (0,
    M.useEffect)(()=>{}
    , [nt]);
    let At = (0,
    M.useMemo)(()=>Y.length > 0, [Y]);
    (0,
    M.useEffect)(()=>{
        if (l.rootRect) {
            let C = mo(l.rootRect);
            if (!is) {
                document.querySelector("#rangeBorderBox")?.remove();
                let P = document.createElement("div");
                P.id = "rangeBorderBox",
                P.style.position = "absolute",
                P.style.left = C.left + "px",
                P.style.top = C.top + window.scrollY + "px",
                P.style.width = C.width + "px",
                P.style.height = C.height + "px",
                P.style.border = "1px solid green",
                P.style.zIndex = "9999",
                P.style.pointerEvents = "none",
                document.body.appendChild(P)
            }
            R.setPositionReference({
                getBoundingClientRect() {
                    return C
                }
            })
        }
    }
    , [l.rootRect]),
    (0,
    M.useEffect)(()=>{
        if (l.open && nt.length > 0) {
            let C = null;
            nt.find(P=>{
                if (P.data.type === "group") {
                    if (P.children.length > 0)
                        return C = P.children.find(K=>K.data.type === "shortcuts") || null,
                        C !== null
                } else if (P.data.type === "shortcuts")
                    return C = P,
                    !0;
                return !1
            }
            ),
            C && g(P=>({
                ...P,
                lastHoverContextMenuId: C?.id || ""
            }))
        }
    }
    , [nt, l.open]),
    (0,
    M.useEffect)(()=>{
        if (l.open) {
            Mt("floatingMenuInputMediator").updateInputValue("");
            let C = ie()?.querySelector(`#${Xe}`);
            C && setTimeout(()=>{
                C?.focus()
            }
            , 1),
            jt().then(P=>{
                a(P)
            }
            )
        } else {
            let P = ie()?.querySelector(`#${Xe}`)?.value;
            P && Mt("chatBoxInputMediator").updateInputValue(P)
        }
    }
    , [l.open]),
    (0,
    M.useEffect)(()=>{
        if (!u.loading && fo()) {
            let C = ie()?.querySelector(`#${Xe}`);
            C && setTimeout(()=>{
                C?.focus()
            }
            , 1)
        }
    }
    , [u.loading]);
    let Wt = async C=>{
        if (C.trim()) {
            let P = m
              , K = ""
              , _e = r.current?.selectionElement;
            _e && (_e.isEditableElement ? _e.editableElementSelectionText ? P ? K = P : K = "{{SELECTED_TEXT}}" : P ? K = P : K = "" : K = "{{SELECTED_TEXT}}");
            let ne = `${C}`;
            K && (ne += `:
"""
${K}
"""`),
            f() || c("Chat"),
            Z([{
                type: "RENDER_TEMPLATE",
                parameters: {
                    template: ne
                }
            }, {
                type: "ASK_CHATGPT",
                parameters: {}
            }])
        }
    }
      , $e = (0,
    M.useRef)(vt);
    (0,
    M.useEffect)(()=>{
        $e.current = vt
    }
    , [vt]),
    (0,
    M.useEffect)(()=>{
        if (b.selectedContextMenuId && De.length > 0 && l.open && !Ve) {
            let C = b.selectedContextMenuId
              , P = !1
              , K = !1
              , _e = !1
              , ne = null;
            if (Nn(C) && (C = C.replace(ht, ""),
            P = !0),
            (!p || y.status !== "success") && (K = !0),
            _e = br(C),
            _e) {
                let Ke = Ir(C);
                Ke && (ne = Ke)
            } else
                ne = De.find(Ke=>Ke.id === C) || null;
            if (ne && ne.id) {
                if (ne.data.type === "group")
                    return;
                _e || Ye.getMediator("textSelectPopupButton").favoriteContextMenu(ne).then().catch(),
                P && (ne = Hn(ne)),
                tt.current = ne;
                let Ke = ne.id
                  , w = ne.data.actions || [];
                if (g(()=>({
                    selectedContextMenuId: null,
                    hoverContextMenuIdMap: {},
                    lastHoverContextMenuId: null
                })),
                f() || c("Chat"),
                w.length > 0)
                    Z(w);
                else if (_e) {
                    if (K) {
                        Be(),
                        d({
                            open: !1,
                            rootRect: null
                        });
                        return
                    }
                    S(V=>({
                        ...V,
                        selectContextMenuId: ne?.id || null
                    })),
                    go(Ke) === "TRY_AGAIN" && $e.current(),
                    setTimeout(()=>{
                        S(V=>({
                            ...V,
                            selectContextMenuId: null
                        }))
                    }
                    , 100)
                }
            }
        }
    }
    , [b.selectedContextMenuId, De, l.open, Ve, y.status, p]),
    (0,
    M.useEffect)(()=>{}
    , [b.selectedContextMenuId]);
    let kt = (0,
    M.useRef)(!1);
    return (0,
    M.useEffect)(()=>{
        let C = je(v);
        if (v.length > 0 && (s === "Chat" || f())) {
            if (kt.current)
                return;
            kt.current = !0,
            tt.current && (tt.current = null),
            Ro(C),
            Z([]),
            tt.current || Mt("floatingMenuInputMediator").updateInputValue("");
            let K = r.current?.selectionElement?.isEditableElement
              , _e = !1;
            (!p || y.status !== "success") && (_e = !0),
            (!K || _e) && (d({
                open: !1,
                rootRect: null
            }),
            Be()),
            He(""),
            Nt().then(()=>{
                (Do.current?.getNextAction()?.error || "") && (d({
                    open: !1,
                    rootRect: null
                }),
                Be())
            }
            ).catch().finally(()=>{
                kt.current = !1
            }
            )
        }
    }
    , [v, p, s]),
    (0,
    M.useEffect)(()=>{
        let C = (P,K)=>{
            K && K?.contextMenu && (tt.current = K.contextMenu),
            He(P)
        }
        ;
        return Mt("floatingMenuInputMediator").subscribe(C),
        ()=>{
            Mt("floatingMenuInputMediator").unsubscribe(C)
        }
    }
    , [He]),
    M.default.createElement(lo, {
        root: t
    }, M.default.createElement("div", {
        ref: R.setFloating,
        ...W(),
        style: {
            position: I,
            zIndex: l.open ? 2147483601 : -1,
            opacity: l.open ? 1 : 0,
            top: _ ?? 0,
            left: xe ?? 0,
            width: H,
            maxWidth: "90vw"
        },
        onKeyUp: C=>{
            C.stopPropagation()
        }
        ,
        onKeyDown: C=>{
            i.current === "notion.so" && C.key !== "Escape" && C.stopPropagation()
        }
        ,
        id: vn,
        "aria-hidden": l.open ? "false" : "true"
    }, M.default.createElement(Po, {
        customOpen: !0,
        defaultPlacement: X.contextMenuPlacement,
        needAutoUpdate: !0,
        hoverOpen: !1,
        menuList: nt,
        referenceElementOpen: l.open,
        referenceElement: M.default.createElement("div", {
            style: {
                boxSizing: "border-box",
                border: "1px solid",
                borderColor: n.customColor.borderColor,
                background: n.customColor.paperBackground,
                borderRadius: "6px",
                boxShadow: "rgb(15 15 15 / 5%) 0px 0px 0px 1px, rgb(15 15 15 / 10%) 0px 3px 6px, rgb(15 15 15 / 20%) 0px 9px 24px",
                overflow: "hidden",
                isolation: "isolate",
                display: "flex",
                flexDirection: "column",
                width: "100%",
                padding: "7px 12px"
            },
            onKeyPress: C=>{
                C.stopPropagation()
            }
        }, M.default.createElement(ei, null), M.default.createElement(G, {
            width: "100%",
            direction: "row",
            alignItems: "center",
            gap: 1
        }, M.default.createElement(Zr, {
            TooltipProps: {
                placement: X.contextMenuPlacement,
                floatingMenuTooltip: !0
            },
            size: 16,
            sx: {
                flexShrink: 0,
                p: "4px",
                alignSelf: "start"
            }
        }), M.default.createElement(G, {
            direction: "row",
            width: 0,
            flex: 1,
            alignItems: "center",
            spacing: 1,
            justifyContent: "left"
        }, Ve ? M.default.createElement(M.default.Fragment, null, M.default.createElement(N, {
            fontSize: "16px",
            color: "primary.main"
        }, e("client:floating_menu__input__running_placeholder")), M.default.createElement(no, {
            size: "16px"
        })) : M.default.createElement(Pr, {
            stopPropagation: !0,
            expandNode: l.open && M.default.createElement(Fr, {
                TooltipProps: {
                    placement: X.contextMenuPlacement,
                    floatingMenuTooltip: !0
                },
                sx: {
                    alignSelf: "end"
                },
                direction: "column",
                size: "tiny"
            }),
            placeholder: l.open ? e("client:floating_menu__input__placeholder") : "",
            InputId: Xe,
            sx: {
                border: "none",
                "& > div": {
                    "& > div": {
                        p: 0
                    },
                    "& > textarea": {
                        p: 0
                    },
                    "& > .max-ai-user-input__expand": {
                        "&:has(> div)": {
                            pr: 1
                        }
                    }
                },
                borderRadius: 0,
                minHeight: "24px"
            },
            onEnter: C=>{
                !h && ot.length > 0 || Wt(C)
            }
        }), !Ve && M.default.createElement(M.default.Fragment, null, M.default.createElement(Fe, {
            floatingMenuTooltip: !0,
            title: e("client:floating_menu__button__send_to_ai"),
            description: "\u23CE",
            placement: X.contextMenuPlacement
        }, M.default.createElement(Pn, {
            sx: {
                height: "24px",
                width: "24px",
                borderRadius: "4px",
                flexShrink: 0,
                alignSelf: "end",
                alignItems: "center",
                p: 0,
                m: 0,
                cursor: At ? "pointer" : "default",
                bgcolor: At ? "primary.main" : "rgb(219,219,217)",
                "&:hover": {
                    bgcolor: At ? "primary.main" : "rgb(219,219,217)"
                }
            },
            onClick: ()=>{
                !h && ot.length > 0 || Wt(Y)
            }
        }, M.default.createElement(ii.default, {
            sx: {
                color: "#fff",
                fontSize: 16
            }
        }))), M.default.createElement(un, {
            sx: {
                width: 24,
                height: 24,
                alignSelf: "end"
            }
        }), M.default.createElement(Ot, {
            TooltipProps: {
                placement: X.contextMenuPlacement,
                floatingMenuTooltip: !0
            }
        })), M.default.createElement(cn, null)))),
        root: t
    })))
}
;
var ss = String(_n).toLowerCase().replace(/_/g, "-")
  , as = ({containerId: o="modal-root", children: t})=>{
    let[e,n] = (0,
    Ge.useState)(null)
      , r = (0,
    Ge.useRef)(null);
    return (0,
    Ge.useEffect)(()=>{
        let i = document.getElementById(o);
        if (i) {
            let u = document.createElement("div");
            u.id = Tn;
            let a = document.createElement("style")
              , s = document.createElement("link");
            if (s.rel = "stylesheet",
            s.href = li.default.runtime.getURL("content_style.css"),
            i.shadowRoot)
                i.shadowRoot.appendChild(u),
                i.shadowRoot.appendChild(a),
                i.shadowRoot.appendChild(s);
            else {
                let c = i.attachShadow({
                    mode: "open"
                });
                c.appendChild(u),
                c.appendChild(a),
                c.appendChild(s)
            }
            r.current = gt({
                key: `${ss}-context-menu`,
                prepend: !0,
                container: a
            }),
            n(u)
        }
    }
    , [o]),
    !e || !r.current ? null : (0,
    ai.createPortal)(Ge.default.createElement(rt, {
        value: r.current
    }, Ge.default.createElement(si, {
        root: e
    }), t), e)
}
  , ui = as;
var Se = A(D());
var ls = ()=>{
    let {closeBeforeRefresh: o} = J(Je)
      , {haveSelection: t, showFloatingContextMenu: e, floatingDropdownMenuOpen: n} = wt()
      , r = Xt("textSelectPopupButton")
      , [i,u] = (0,
    Se.useState)(16)
      , [a,s] = (0,
    Se.useState)(3)
      , {chatBoxShortCutKey: c} = Qe();
    return (0,
    Se.useEffect)(()=>{
        if (!(r?.buttonVisible && !o) && t) {
            let l = document.querySelector(`#${Ut}`);
            l && l.classList.contains("open") ? u((l.getBoundingClientRect().width || 0) + 16) : u(16),
            s(1)
        }
    }
    , [t, r, o]),
    (0,
    Se.useEffect)(()=>{
        if (a === 1)
            s(2);
        else if (a === 2) {
            let l = setTimeout(()=>{
                s(3)
            }
            , 2e3);
            return ()=>{
                clearTimeout(l)
            }
        }
        return ()=>{}
    }
    , [a]),
    (0,
    Se.useEffect)(()=>{
        s(3)
    }
    , [n]),
    null;
    return Se.default.createElement(Se.default.Fragment, null, c ? Se.default.createElement(F, {
        className: "usechatgpt-ai__context-menu--handle-button",
        sx: {
            position: "fixed",
            bottom: 16,
            right: i,
            zIndex: a !== 3 ? 2147483661 : -1,
            backgroundColor: "rgba(98,98,105,1)",
            borderRadius: "8px",
            cursor: "pointer",
            transition: "all 0.3s ease-in-out",
            overflow: "hidden",
            maxWidth: a !== 3 ? "100%" : 0,
            display: "grid"
        },
        component: "div",
        onClick: e
    }, Se.default.createElement(N, {
        fontSize: "24px",
        fontWeight: "bold",
        color: "#fff",
        noWrap: !0,
        sx: {
            px: "10px",
            py: "4px"
        }
    }, c)) : Se.default.createElement(F, {
        sx: {
            position: "fixed",
            bottom: 16,
            right: i,
            zIndex: a !== 3 ? 2147483661 : -1,
            backgroundColor: "#fff",
            borderRadius: "8px",
            cursor: "pointer",
            transition: "all 0.3s ease-in-out",
            maxWidth: a !== 3 ? "100%" : 0,
            display: "grid"
        },
        component: "div",
        onClick: e
    }, Se.default.createElement(Yt, {
        elevation: 3,
        sx: {
            padding: "8px 10px"
        }
    }, Se.default.createElement(we, {
        sx: {
            fontSize: 24
        }
    }))))
}
  , ci = ls;
var ge = A(D());
var Tt = A(D());
var us = o=>{
    let {buttonSettingKey: t, placement: e, onClick: n} = o
      , {t: r} = z(["common", "client", "prompt"])
      , {favoriteContextMenuList: i} = Wn(t);
    return Tt.default.createElement(G, {
        direction: "row",
        alignItems: "center",
        className: "max-ai__click-menu-button--box",
        sx: {
            "&.max-ai__click-menu-button--box": {
                "& button": {
                    padding: "5px 5px!important",
                    "&:has(.max-ai__click-menu-button--box__text-icon)": {
                        padding: "3px 3px!important"
                    }
                }
            }
        }
    }, i?.map(u=>{
        let a = !u.data.icon
          , s = u.text
          , c = u.id.replace(ht, "")
          , l = `prompt:${c}`;
        r(l) !== c && (s = r(l));
        let d = String(s[0] || "").toUpperCase();
        return Tt.default.createElement(Ct, {
            TooltipProps: {
                floatingMenuTooltip: !0,
                placement: e || "bottom"
            },
            title: s,
            key: u.id,
            sx: {
                minWidth: "unset",
                p: a ? "6px!important" : "8px!important"
            },
            onMouseUp: m=>{
                m.stopPropagation(),
                m.preventDefault()
            }
            ,
            onMouseDown: m=>{
                m.stopPropagation(),
                m.preventDefault()
            }
            ,
            onClick: m=>{
                m.stopPropagation(),
                m.preventDefault(),
                n && n(u)
            }
        }, a ? Tt.default.createElement(G, {
            className: "max-ai__click-menu-button--box__text-icon",
            alignItems: "center",
            justifyContent: "center",
            sx: {
                width: "22px",
                height: "22px",
                boxSizing: "border-box",
                borderRadius: "4px",
                bgcolor: m=>m.palette.mode === "dark" ? "#4f4f4f" : "#F5F6F7",
                color: m=>m.palette.mode === "dark" ? "rgba(255,255,255,.87)" : "rgba(0,0,0,.6)"
            }
        }, Tt.default.createElement(N, {
            component: "span",
            fontSize: "13px",
            color: "inherit"
        }, d)) : Tt.default.createElement(ue, {
            icon: u.data.icon,
            sx: {
                fontSize: "18px",
                color: m=>m.palette.mode === "dark" ? "rgba(255,255,255,.87)" : "rgba(0,0,0,.6)"
            }
        }))
    }
    ))
}
  , pi = us;
var Bo = A(D());
var mi = o=>{
    let {sx: t, placement: e, TooltipProps: n} = o
      , {t: r} = z(["common", "client"])
      , {createSearchWithAI: i} = Eo();
    return Bo.default.createElement(G, {
        direction: "row",
        alignItems: "center",
        className: "max-ai__click-menu-button--box",
        sx: {
            "&.max-ai__click-menu-button--box": {
                "& button": {
                    padding: "5px 5px!important",
                    "&:has(.max-ai__click-menu-button--box__text-icon)": {
                        padding: "3px 3px!important"
                    }
                }
            },
            ...t
        }
    }, Bo.default.createElement(Ct, {
        TooltipProps: {
            floatingMenuTooltip: !0,
            placement: e || "bottom",
            ...n
        },
        title: r("client:sidebar__tabs__search__tooltip"),
        sx: {
            minWidth: "unset",
            p: "8px!important"
        },
        onMouseUp: u=>{
            u.stopPropagation(),
            u.preventDefault()
        }
        ,
        onMouseDown: u=>{
            u.stopPropagation(),
            u.preventDefault()
        }
        ,
        onClick: async u=>{
            u.stopPropagation(),
            u.preventDefault();
            let a = window.getSelection()?.toString();
            a && await i(a, !1)
        }
    }, Bo.default.createElement(ue, {
        icon: "Search",
        sx: {
            fontSize: "18px",
            color: u=>u.palette.mode === "dark" ? "rgba(255,255,255,.87)" : "rgba(0,0,0,.6)"
        }
    })))
}
;
var cs = o=>{
    let {t} = z(["common", "client"])
      , {tempSelection: e, show: n, hideRangy: r} = Le()
      , {chatBoxShortCutKey: i} = Qe()
      , u = Xt("textSelectPopupButton")
      , a = re(at)
      , s = J(Pe)
      , c = re(ho)
      , {closeBeforeRefresh: l} = J(Je)
      , {showFloatingContextMenu: d} = wt()
      , [m] = Q(he)
      , p = (0,
    ge.useMemo)(()=>n && u?.buttonVisible && !l && !m.open, [l, n, u, m])
      , {x: y, y: x, strategy: S, refs: f, placement: h} = It({
        placement: "bottom-start",
        middleware: [ro({
            fallbackPlacements: ["top-start", "right", "left"]
        }), so({
            crossAxis: !0,
            padding: 16
        }), io(g=>{
            if (g.placement.indexOf("bottom") > -1) {
                let v = {
                    left: 0,
                    right: window.innerWidth,
                    top: 0,
                    bottom: window.innerHeight + window.scrollY
                };
                return hr({
                    top: g.y,
                    left: g.x,
                    bottom: g.y + g.rects.floating.height + 50,
                    right: g.rects.floating.width + g.x
                }, v) ? g.rects.reference.y - g.y - g.rects.floating.height - 8 : 8
            } else
                return 8
        }
        )]
    });
    (0,
    ge.useEffect)(()=>{
        if (!e || !p)
            return;
        let g = mo(e.selectionRect);
        if (p && g) {
            if (g = Cr(g),
            !it) {
                document.querySelector("#rangeBorderBox")?.remove();
                let v = document.createElement("div");
                v.id = "rangeBorderBox",
                v.style.position = "absolute",
                v.style.left = g.left + "px",
                v.style.top = g.top + window.scrollY + "px",
                v.style.width = g.width + "px",
                v.style.height = g.height + "px",
                v.style.border = "2px solid red",
                v.style.zIndex = "9999",
                v.style.pointerEvents = "none",
                document.body.appendChild(v)
            }
            f.setPositionReference({
                getBoundingClientRect() {
                    return {
                        ...g,
                        x: g.left,
                        y: g.top
                    }
                }
            })
        }
    }
    , [e, p]);
    let b = (0,
    ge.useCallback)(()=>{
        if (f.floating.current) {
            if (getComputedStyle(f.floating.current).opacity === "0")
                return;
            r(),
            Co(),
            So()
        }
    }
    , []);
    return (0,
    ge.useEffect)(()=>{
        let g = v=>{
            v.key === "Escape" && b()
        }
        ;
        return document.addEventListener("keydown", g, !0),
        ()=>{
            document.removeEventListener("keydown", g, !0)
        }
    }
    , []),
    (0,
    ge.useEffect)(()=>{
        s.loading && (setTimeout(()=>{
            b()
        }
        , 1e3),
        b())
    }
    , [s.loading]),
    ge.default.createElement(Yt, {
        elevation: 3,
        component: "div",
        ref: f.setFloating,
        className: `max-ai__click-context-menu ${p ? "open" : "close"}`,
        sx: {
            bgcolor: "transparent",
            borderRadius: "14px",
            zIndex: p ? 2147483600 : -1,
            position: S,
            opacity: p ? 1 : 0,
            top: x ?? 0,
            left: y ?? 0,
            width: "max-content"
        }
    }, ge.default.createElement(G, {
        direction: "row",
        alignItems: "center",
        sx: {
            "& .max-ai__click-menu-button--box": {
                div: {
                    display: "flex"
                },
                height: "28px",
                position: "relative",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                "&:hover": {
                    "&:has(button)&::after": {
                        display: "none"
                    }
                },
                "& button": {
                    bgcolor: "background.paper",
                    minWidth: "unset",
                    padding: "5px 8px!important",
                    boxSizing: "border-box",
                    borderRadius: "0",
                    "&:hover": {
                        bgcolor: g=>g.palette.mode === "dark" ? "rgb(61,61,61)" : "rgb(224,224,224)"
                    },
                    "&:has(.max-ai__click-menu-button--box__text-icon)": {
                        padding: "3px 6px!important"
                    }
                },
                "&:first-child": {
                    "& button": {
                        borderTopLeftRadius: "14px",
                        borderBottomLeftRadius: "14px",
                        borderTopRightRadius: 0,
                        borderBottomRightRadius: 0
                    }
                },
                "&:not(:last-child)": {
                    "&::after": {
                        content: '""',
                        position: "absolute",
                        right: 0,
                        top: "25%",
                        transform: "scale(0.5) translateY(-50%)",
                        width: "1px",
                        height: "32px",
                        bgcolor: g=>g.palette.mode === "dark" ? "rgb(61,61,61)" : "rgb(224,224,224)"
                    }
                }
            }
        }
    }, ge.default.createElement(F, {
        component: "div",
        className: "max-ai__click-menu-button--box"
    }, ge.default.createElement(Ct, {
        TooltipProps: {
            floatingMenuTooltip: !0,
            placement: h,
            description: i,
            sx: {
                maxWidth: 360
            }
        },
        title: t("client:floating_menu__button__cta__tooltip"),
        className: "usechatgpt-ai__context-menu--handle-button",
        id: "max_ai__floating_context_menu__cta_button",
        size: "small",
        variant: "text",
        onMouseUp: g=>{
            g.stopPropagation(),
            g.preventDefault()
        }
        ,
        onMouseDown: g=>{
            g.stopPropagation(),
            g.preventDefault()
        }
        ,
        onClick: g=>{
            g.stopPropagation(),
            g.preventDefault();
            let v = window.getSelection()?.rangeCount;
            if (v && v > 0) {
                let Z = window.getSelection()?.getRangeAt(0)?.cloneRange();
                c({
                    range: Z || null,
                    selectionText: window?.getSelection()?.toString() || ""
                })
            }
            e && d()
        }
    }, ge.default.createElement(we, {
        sx: {
            fontSize: "18px"
        }
    }))), ge.default.createElement(mi, {
        placement: h
    }), ge.default.createElement(pi, {
        placement: h,
        buttonSettingKey: "textSelectPopupButton",
        onClick: g=>{
            e && d(),
            setTimeout(()=>{
                a(v=>({
                    ...v,
                    selectedContextMenuId: g.id
                }))
            }
            , 100)
        }
    }), ge.default.createElement(ln, {
        placement: h
    })))
}
  , di = cs;
var Re = A(D())
  , hi = A(Sn());
Oo();
No();
var U = A(D());
Oo();
No();
var se = A(D());
var ps = o=>{
    let {buttonKey: t, children: e, rootId: n, root: r, permissionWrapperCardSceneType: i} = o
      , [u,a] = (0,
    se.useState)(null)
      , {currentSidebarConversationType: s, updateSidebarConversationType: c} = ce()
      , {currentUserPlan: l} = ze()
      , d = to()
      , {createConversation: m} = bt()
      , {contextMenuList: p} = xo(t, "", !1)
      , {loading: y} = J(Pe)
      , {setShortCuts: x, runShortCuts: S} = ye()
      , f = (0,
    se.useRef)(null)
      , h = (0,
    se.useMemo)(()=>!(i && l.name === "free"), [i, l])
      , b = (0,
    se.useCallback)(async H=>{
        if (!y && H.data.actions) {
            let X = await Kt()
              , xe = `ON_BOARDING_RECORD_INPUT_ASSISTANT_BUTTON_${Me()}_TIMES`
              , _ = Number(X[xe] || 0);
            if (!h && i)
                if (_ > 0)
                    await Bt(xe, _ - 1);
                else {
                    Be(),
                    oo("show", i);
                    let R = await m();
                    await st("add", R, 0, [eo(d[i])]);
                    return
                }
            let I = je(H.data.actions);
            I.splice(0, 0, {
                type: "SET_VARIABLE_MAP",
                parameters: {
                    VariableMap: {
                        OperationElementElementSelector: `[maxai-input-assistant-button-id="${n}"]`
                    }
                }
            }),
            await x(I),
            await S(!0)
        }
    }
    , [x, S, y, h, i])
      , g = (0,
    se.useRef)(b);
    (0,
    se.useEffect)(()=>{
        g.current = b
    }
    , [b]);
    let v = (0,
    se.useRef)(!1)
      , Z = (0,
    se.useRef)(s);
    return (0,
    se.useEffect)(()=>{
        Z.current = s
    }
    , [s]),
    (0,
    se.useEffect)(()=>{
        !v.current && u && g.current && Z.current === "Chat" && (v.current = !0,
        a(null),
        g.current(u).then().catch().finally(()=>{
            v.current = !1
        }
        ))
    }
    , [u]),
    (0,
    se.useEffect)(()=>{
        if (r && n && !f.current) {
            let H = document.createElement("style");
            H.setAttribute("data-emotion-id", n),
            r.appendChild(H),
            f.current = gt({
                key: "max-ai-input-assistant-context-menu",
                prepend: !0,
                container: H
            })
        }
    }
    , [r, n]),
    !r || !f.current ? null : se.default.createElement(rt, {
        value: f.current
    }, se.default.createElement(Po, {
        defaultPlacement: "bottom-start",
        defaultFallbackPlacements: ["bottom-end", "bottom", "top-start", "top-end", "top", "right", "left"],
        root: r,
        menuList: p,
        needAutoUpdate: !0,
        hoverOpen: !1,
        menuWidth: 240,
        referenceElement: e,
        onClickContextMenu: async H=>{
            c("Chat"),
            a(H)
        }
        ,
        onClickReferenceElement: ()=>{}
    }))
}
  , mn = ps;
var ms = o=>{
    let {rootId: t, InputAssistantBoxSx: e, DropdownButtonStyle: n, CTAButtonStyle: r, buttonGroup: i, shadowRoot: u, placement: a} = o
      , s = (0,
    U.useRef)(null)
      , {t: c} = z(["client"])
      , [l,d] = (0,
    U.useState)(null)
      , {loading: m} = J(Pe)
      , [p,y] = (0,
    U.useState)(!1)
      , [x,S] = (0,
    U.useState)(!1)
      , f = (0,
    U.useMemo)(()=>{
        let b = je(r)
          , g = je(n)
          , v = {}
          , Z = {};
        if (i.forEach(H=>{
            H.CTAButtonStyle && (b = Object.assign(b, {
                ...H.CTAButtonStyle
            })),
            H.DropdownButtonStyle && (g = Object.assign(g, {
                ...H.DropdownButtonStyle
            }))
        }
        ),
        v) {
            let {backgroundColor: H="#7601D3", hoverBackgroundColor: X="rgb(94,34,169)", color: xe="#fff", hoverColor: _="#fff", borderColor: I="rgb(77, 26, 137)", hoverBorderColor: R="rgb(77, 26, 137)", borderRadius: k="4px 0 0 4px", borderWidth: ee="0 1px 0 0", iconSize: O=20, padding: W="8px 12px"} = b || {};
            v = {
                minWidth: "unset",
                backgroundColor: H,
                color: xe,
                borderColor: I,
                borderRadius: k,
                fontSize: `${O}px`,
                borderWidth: ee,
                borderStyle: "solid",
                position: "relative",
                padding: W,
                iconSize: O,
                "&:hover": {
                    color: _,
                    backgroundColor: X,
                    borderColor: R
                }
            }
        }
        if (Z) {
            let {backgroundColor: H="#7601D3", hoverBackgroundColor: X="rgb(94,34,169)", color: xe="#fff", hoverColor: _="#fff", borderColor: I="transparent", hoverBorderColor: R="transparent", borderRadius: k="0 4px 4px 0", borderWidth: ee="0", iconSize: O=20, padding: W="8px 4px"} = g || {};
            Z = {
                minWidth: "unset",
                backgroundColor: p ? X : H,
                color: p ? _ : xe,
                borderColor: p ? R : I,
                borderRadius: k,
                fontSize: `${O}px`,
                borderWidth: ee,
                borderStyle: "solid",
                padding: W,
                iconSize: O,
                "&:hover": {
                    color: _,
                    backgroundColor: X,
                    borderColor: R
                }
            }
        }
        return {
            ctaButtonSx: v,
            dropdownButtonSx: Z
        }
    }
    , [r, n, p, i])
      , h = (0,
    U.useMemo)(()=>{
        let b = je(e) || {};
        i.forEach(v=>{
            v.InputAssistantBoxSx && Object.assign(b, v.InputAssistantBoxSx)
        }
        );
        let g = {
            boxShadow: "0px 2px 3px 1px rgba(118, 1, 211, 0.16), 1px 0px 2px 0px rgba(118, 1, 211, 0.08), -1px 0px 2px 0px rgba(118, 1, 211, 0.08)",
            ...b?.["&:hover"]
        };
        return g && delete b["&:hover"],
        {
            ...b,
            ...x ? g : {}
        }
    }
    , [e, x, i]);
    return (0,
    U.useEffect)(()=>{
        if (u) {
            let b = document.createElement("style");
            u.appendChild(b),
            s.current = gt({
                key: "max-ai-input-assistant-context-menu",
                prepend: !0,
                container: b
            })
        }
    }
    , [u]),
    (0,
    U.useEffect)(()=>{
        d(document.querySelector(`#${Pt}`)?.shadowRoot?.querySelector("div"))
    }
    , []),
    U.default.createElement("div", {
        style: {
            display: "flex",
            flexDirection: "row",
            alignItems: "center",
            borderRadius: "4px",
            ...h
        },
        onMouseEnter: ()=>S(!0),
        onMouseLeave: ()=>S(!1)
    }, i[0] && U.default.createElement(mn, {
        rootId: t,
        buttonKey: i[0].buttonKey,
        permissionWrapperCardSceneType: i[0].permissionWrapperCardSceneType,
        root: l
    }, U.default.createElement(F, null, U.default.createElement(Fe, {
        placement: a,
        zIndex: 2e6,
        PopperProps: {
            container: l
        },
        title: c(i[0].tooltip)
    }, U.default.createElement("div", {
        style: {
            display: "flex",
            flexDirection: "column",
            position: "relative",
            cursor: "pointer"
        },
        onMouseEnter: ()=>{
            y(!0)
        }
        ,
        onMouseLeave: ()=>{
            y(!1)
        }
    }, s.current && U.default.createElement(rt, {
        value: s.current
    }, U.default.createElement(F, {
        position: "absolute",
        top: `-${r?.transparentHeight || 0}px`,
        width: "100%",
        height: `${r?.transparentHeight || 0}px`,
        bgcolor: it ? "transparent" : "red",
        zIndex: 2000001
    }), U.default.createElement($, {
        id: `maxAIInputAssistantCtaButton${t}`,
        "data-testid": "maxai-input-assistant-cta-button",
        disabled: m,
        sx: f.ctaButtonSx
    }, m ? U.default.createElement(no, {
        size: f.ctaButtonSx?.iconSize || 16,
        sx: {
            fontSize: "inherit",
            color: "#fff"
        }
    }) : U.default.createElement(we, {
        sx: {
            fontSize: "inherit",
            color: "inherit"
        }
    })), U.default.createElement(F, {
        position: "absolute",
        bottom: `-${r?.transparentHeight || 0}px`,
        width: "100%",
        height: `${r?.transparentHeight || 0}px`,
        bgcolor: it ? "transparent" : "red",
        zIndex: 2000001
    })))))), i[1] && U.default.createElement(mn, {
        rootId: t,
        buttonKey: i[1].buttonKey,
        permissionWrapperCardSceneType: i[1].permissionWrapperCardSceneType,
        root: l
    }, U.default.createElement(F, null, U.default.createElement(Fe, {
        placement: a,
        zIndex: 2e6,
        PopperProps: {
            container: l
        },
        title: c(i[1].tooltip)
    }, U.default.createElement("div", {
        style: {
            display: "flex",
            flexDirection: "column",
            position: "relative",
            cursor: "pointer"
        }
    }, s.current && U.default.createElement(rt, {
        value: s.current
    }, U.default.createElement(F, {
        position: "absolute",
        top: `-${n?.transparentHeight || 0}px`,
        width: "100%",
        height: `${n?.transparentHeight || 0}px`,
        bgcolor: it ? "transparent" : "red",
        zIndex: 2000001
    }), U.default.createElement($, {
        id: `maxAIInputAssistantDropdownButton${t}`,
        "data-testid": "maxai-input-assistant-dropdown-button",
        disabled: m,
        sx: f.dropdownButtonSx
    }, U.default.createElement(ue, {
        icon: "ArrowDropDown",
        sx: {
            fontSize: "inherit",
            color: "inherit"
        }
    })), U.default.createElement(F, {
        position: "absolute",
        bottom: `-${n?.transparentHeight || 0}px`,
        width: "100%",
        height: `${n?.transparentHeight || 0}px`,
        bgcolor: it ? "transparent" : "red",
        zIndex: 2000001
    })))))))
}
  , fi = ms;
var ds = o=>{
    let t = Me();
    return t === "mail.google.com" ? fs(o) : t === "outlook.office.com" || t === "outlook.live.com" || t === "outlook.office365.com" ? gs(o) : t === "twitter.com" ? xs(o) : t === "linkedin.com" ? hs(o) : t === "facebook.com" ? ys(o) : t === "youtube.com" ? [o.buttonGroupConfig.composeReplyButton, o.buttonGroupConfig.refineDraftButton] : t === "studio.youtube.com" ? [o.buttonGroupConfig.composeReplyButton, o.buttonGroupConfig.refineDraftButton] : t === "instagram.com" ? Cs(o) : t === "reddit.com" ? Ss(o) : [o.buttonGroupConfig.composeReplyButton, o.buttonGroupConfig.refineDraftButton]
}
  , fs = o=>{
    let {keyElement: t, buttonGroupConfig: e} = o
      , n = document.querySelectorAll("div[data-message-id]");
    for (let r = 0; r < n.length; r++)
        if (n[r].nextElementSibling?.contains(t))
            return [e.composeReplyButton, e.refineDraftButton];
    return [e.composeNewButton, e.refineDraftButton]
}
  , gs = o=>{
    let {keyElement: t, buttonGroupConfig: e} = o
      , n = document.querySelector('div[data-app-section="ConversationContainer"]')
      , r = document.querySelector("#ReadingPaneContainerId")
      , i = r.querySelectorAll('div[role="textbox"]:has(#removeButton)').length
      , u = r.querySelector("#RplyFwdMsg") || r.querySelector("#divRplyFwdMsg")
      , a = Array.from(document.querySelectorAll('div[role="dialog"]')).find(c=>c.contains(t))
      , s = r.querySelector('input[maxlength="255"]')?.value || "";
    return !n?.contains(t) && i === 0 && !u && !a && !s ? [e.composeNewButton, e.refineDraftButton] : [e.composeReplyButton, e.refineDraftButton]
}
  , xs = o=>{
    let {keyElement: t, buttonGroupConfig: e} = o;
    return Rr(t)?.querySelector('article[data-testid="tweet"]') ? [e.composeReplyButton, e.refineDraftButton] : Array.from(document.querySelectorAll('article[data-testid="tweet"]')).find(i=>i.nextElementSibling?.contains(t)) ? [e.composeReplyButton, e.refineDraftButton] : [e.composeNewButton, e.refineDraftButton]
}
  , hs = o=>{
    let {keyElement: t, buttonGroupConfig: e} = o;
    return t.classList.contains("share-box_actions") ? [e.composeNewButton, e.refineDraftButton] : [e.composeReplyButton, e.refineDraftButton]
}
  , ys = o=>{
    let {keyElement: t, buttonGroupConfig: e} = o;
    return Mo('form[method="POST"]', t, 20) ? [e.composeNewButton, e.refineDraftButton] : Mo('form[role="presentation"]', t)?.getBoundingClientRect().width < 240 ? [] : [e.composeReplyButton, e.refineDraftButton]
}
  , Cs = o=>{
    let {keyElement: t, buttonGroupConfig: e} = o
      , n = Mo('div[contenteditable="true"]', t, 20)
      , r = Lr('div[aria-label][role="dialog"]', n);
    return n && r ? [e.composeNewButton, e.refineDraftButton] : [e.composeReplyButton, e.refineDraftButton]
}
  , Ss = o=>{
    let {keyElement: t, buttonGroupConfig: e} = o;
    return t.querySelector('button[type="submit"]') ? [e.composeReplyButton, e.refineDraftButton] : [e.composeNewButton, e.refineDraftButton]
}
  , dn = ds;
var gi = new xt("ContextMenu/InputAssistantButtonManager")
  , fn = class {
    constructor() {
        this.interval = 1e3;
        this.stop = !1,
        this.host = Me(),
        this.config = Dn[this.host],
        this.observerMap = new Map
    }
    createInputAssistantButtonListener(t) {
        this.timer = setInterval(()=>{
            if (!this.stop && this.config) {
                let {rootSelectors: e, rootSelectorStyle: n, rootParentDeep: r=0} = this.config
                  , i = [];
                e.map(s=>i.push(...document.querySelectorAll(s)));
                let u = !1;
                i.forEach(s=>{
                    let c = s
                      , l = s
                      , d = r;
                    for (; d > 0; )
                        d--,
                        l = l.parentElement;
                    n && Et(c, n);
                    let m = this.attachInputAssistantButton(l);
                    m && (u = !0,
                    gi.info("newObserverData: ", m))
                }
                ),
                (this.cleanObserverMap() || u) && t(this.getAllObserverData(), this.config)
            }
        }
        , this.interval)
    }
    attachInputAssistantButton(t) {
        if (!this.config || t.querySelector("[maxai-input-assistant-button-id]"))
            return null;
        let {rootStyle: e, rootParentStyle: n, rootParentStyleDeep: r=1, rootNextElementSiblingStyle: i, rootPreviousElementSiblingStyle: u} = this.config;
        if (t && e) {
            if (u && t.previousElementSibling) {
                let b = t.previousElementSibling;
                Et(b, u)
            }
            if (t.style.cssText = e,
            i && t.nextElementSibling) {
                let b = t.nextElementSibling;
                Et(b, i)
            }
        }
        if (n) {
            let b = 0
              , g = t;
            for (; b < r; )
                b++,
                g = g?.parentElement;
            g && Et(g, n)
        }
        let a = Vt()
          , {rootWrapperTagName: s, appendPosition: c, rootWrapperStyle: l} = this.config
          , d = "customElements"in window
          , m = document.createElement(s);
        l && Et(m, l);
        let p = document.createElement(d ? "maxai-input-assistant-button" : "div");
        if (p.setAttribute("maxai-input-assistant-button-id", a),
        m.appendChild(p),
        Ln(c)) {
            let b = t.childNodes[c];
            b ? t.insertBefore(m, b) : t.appendChild(m)
        } else
            t.appendChild(m);
        p.attachShadow({
            mode: "open"
        });
        let y = p.shadowRoot
          , x = document.createElement("div");
        y?.appendChild(x),
        gi.info("appendElement: ", m);
        let S = new MutationObserver(()=>{}
        );
        if (S.observe(t, {
            childList: !0,
            subtree: !0
        }),
        dn({
            keyElement: t,
            buttonGroupConfig: this.config
        }).length === 0)
            return S.disconnect(),
            m.remove(),
            null;
        let h = {
            id: a,
            destroy: ()=>{
                S.disconnect(),
                m.remove()
            }
            ,
            renderRootElement: x,
            observer: S,
            shadowRootElement: y,
            buttonGroup: dn({
                keyElement: t,
                buttonGroupConfig: this.config
            })
        };
        return this.observerMap.set(t, h),
        h
    }
    cleanObserverMap() {
        let t = !1;
        return this.observerMap.forEach((e,n)=>{
            let i = Array.from(e.shadowRootElement.querySelectorAll("style[data-emotion]")).find(u=>u.sheet?.cssRules.length === 0 && u.innerHTML === "");
            document.body.contains(n) && !i || (t = !0,
            e.destroy(),
            this.observerMap.delete(n))
        }
        ),
        t
    }
    clearObserverMap() {
        this.observerMap.forEach((t,e)=>{
            t.destroy(),
            this.observerMap.delete(e)
        }
        )
    }
    getAllObserverData() {
        let t = [];
        return this.observerMap.forEach(e=>t.push(e)),
        t
    }
    pause() {
        this.stop = !0,
        this.clearObserverMap()
    }
    continue() {
        this.stop = !1
    }
}
  , xi = fn;
var bs = ()=>{
    let o = J(qe)
      , [t,e] = (0,
    Re.useState)(null)
      , [n,r] = (0,
    Re.useState)([])
      , i = Re.default.useRef(null);
    ke(()=>{
        i.current = new xi,
        i.current.createInputAssistantButtonListener((a,s)=>{
            r(a),
            e(s)
        }
        )
    }
    );
    let u = (0,
    Re.useMemo)(()=>{
        let a = Me();
        return a === "mail.google.com" ? o.userSettings?.inputAssistantButton?.gmail === !0 : a === "outlook.live.com" || a === "outlook.office.com" || a === "outlook.office365.com" ? o.userSettings?.inputAssistantButton?.outlook === !0 : a === "twitter.com" ? o.userSettings?.inputAssistantButton?.twitter === !0 : a === "linkedin.com" ? o.userSettings?.inputAssistantButton?.linkedIn === !0 : a === "facebook.com" ? o.userSettings?.inputAssistantButton?.facebook === !0 : a === "youtube.com" || a === "studio.youtube.com" ? o.userSettings?.inputAssistantButton?.youtube === !0 : a === "instagram.com" ? o.userSettings?.inputAssistantButton?.instagram === !0 : a === "reddit.com" ? o.userSettings?.inputAssistantButton?.reddit === !0 : !1
    }
    , [o.userSettings?.inputAssistantButton]);
    return (0,
    Re.useEffect)(()=>{
        i.current && (u ? i.current?.continue() : i.current?.pause())
    }
    , [u]),
    Re.default.createElement(Re.default.Fragment, null, n.map(a=>(0,
    hi.createPortal)(Re.default.createElement(fi, {
        shadowRoot: a.shadowRootElement,
        rootId: a.id,
        buttonGroup: a.buttonGroup,
        root: a.renderRootElement,
        InputAssistantBoxSx: t?.InputAssistantBoxSx,
        CTAButtonStyle: t?.CTAButtonStyle,
        DropdownButtonStyle: t?.DropdownButtonStyle
    }), a.renderRootElement, a.id)))
}
  , yi = bs;
var Is = ()=>ut.default.createElement(ut.default.Fragment, null, ut.default.createElement(ui, {
    containerId: Gt
}, ut.default.createElement(di, null), ut.default.createElement(ci, null)), ut.default.createElement(yi, null))
  , Ci = Is;
var ae = A(D());
var gn = A(Oi());
Nr(gn.default);
Hr(gn.default);
var et = new xt("ContextMenu/Rangy")
  , Ms = new $t({
    runtime: "client"
})
  , Es = ()=>{
    let {show: o, initRangyCore: t, rangy: e, showRangy: n, hideRangy: r, saveTempSelection: i, currentSelection: u} = Le()
      , s = J(qe).userSettings
      , {chatBoxShortCutKey: c} = Qe()
      , [l,d] = Q(he)
      , {currentSidebarConversationMessages: m} = ce()
      , [,p] = Q(yo)
      , y = re(ho);
    wr();
    let[x,S] = Q(_t)
      , f = (0,
    ae.useRef)(null)
      , h = (0,
    ae.useRef)(null)
      , {showFloatingContextMenuWithVirtualElement: b} = wt();
    ke(()=>{
        Promise.all([import("./7KIC3H3U.js"), import("./5FYG5HQB.js"), import("./PZGV7OON.js")]).then(([{default: _},{default: I},{default: R}])=>{
            let k = ()=>{
                t(_)
            }
            ;
            I(_),
            R(_),
            _.init(),
            _.addInitListener(k)
        }
        )
    }
    );
    let g = (0,
    ae.useRef)(o);
    (0,
    ae.useEffect)(()=>{
        g.current = o
    }
    , [o]);
    let v = (0,
    ae.useCallback)(_=>{
        {
            if (g.current && _ instanceof KeyboardEvent && _.key === "Escape") {
                et.info("Escape close floating button"),
                r(),
                Co(),
                So();
                return
            }
            let I = _.target
              , R = _ instanceof MouseEvent
              , k = bo()
              , ee = (e?.getSelection()?.toString() || document?.getSelection()?.toString() || "").trim().replace(/\u200B/g, "");
            if (I) {
                if (I && (I.id === Ut || I.id === Gt || I.id === wn))
                    return;
                if (f.current && (I = f.current),
                k && I?.tagName !== "INPUT" && I?.tagName !== "TEXTAREA") {
                    let He = Ft(k);
                    He.isEditableElement && (I = He.editableElement)
                }
                if (!I)
                    return;
                let {editableElement: Y} = Ft(I);
                if (Y && (I = Y),
                !Y && !ee) {
                    r(),
                    h.current = null;
                    return
                }
                h.current = Yo(I, {
                    target: I,
                    eventType: R ? "mouseup" : "keyup"
                }),
                et.info(`native selection [${R ? "mouse" : "keyboard"}]: 	`, h.current, I)
            }
            let O = !1
              , W = !1;
            h.current && (h.current?.isEditableElement ? (O = !0,
            (h.current?.editableElementSelectionText || e.getSelection()?.toString() || document.getSelection()?.toString()) && (W = !0)) : h.current?.selectionText && (O = !0,
            W = !0),
            O && (i({
                selectionText: h.current?.editableElementSelectionText || h.current.selectionText,
                selectionHTML: h.current?.editableElementSelectionText || h.current.selectionHTML,
                selectionRect: h.current.selectionRect,
                activeElement: h.current.target,
                selectionInputAble: h.current?.isEditableElement,
                selectionElement: h.current
            }),
            et.info("save selection temp data", h.current?.isEditableElement, `
`, h.current?.editableElementSelectionText, `
`, h.current?.selectionText)),
            W ? (et.info("show floating button"),
            n()) : (et.info("hide floating button"),
            r()))
        }
    }
    , [e, i, n, r])
      , Z = (0,
    ae.useRef)(v);
    (0,
    ae.useEffect)(()=>{
        Z.current = v
    }
    , [v]);
    let H = (0,
    ae.useRef)(()=>{}
    );
    (0,
    ae.useEffect)(()=>{
        let _ = We(Z.current, 200)
          , I = We(Z.current, 200)
          , R = k=>{
            H.current(),
            H.current = Tr(Y=>{
                if (!Y.selectionText && (r(),
                !Y.isEditableElement)) {
                    h.current = null;
                    return
                }
                h.current = Y,
                Y.selectionText && (Y.eventType === "mouseup" ? _({
                    target: null
                }) : I({
                    target: null
                }))
            }
            );
            let ee = k.target
              , {isEditableElement: O, editableElement: W} = Ft(ee);
            if (O && W) {
                if (f.current?.isSameNode(W))
                    return;
                f.current && (f.current.removeEventListener("mouseup", _),
                f.current.removeEventListener("keyup", I)),
                et.info("save targetElement ref", W),
                f.current = W,
                W.addEventListener("mouseup", _),
                W.addEventListener("keyup", I)
            } else
                et.info("clear targetElement ref"),
                f.current = null
        }
        ;
        return document.addEventListener("mousedown", R),
        ()=>{
            document.removeEventListener("mousedown", R),
            f.current && (f.current.removeEventListener("mouseup", _),
            f.current.removeEventListener("keyup", I))
        }
    }
    , [e, c, s?.shortcutHintEnable]),
    (0,
    ae.useEffect)(()=>{
        let _ = We(Z.current, 200)
          , I = We(Z.current, 200)
          , R = ()=>{}
        ;
        return e?.initialized && (document.addEventListener("mouseup", _),
        document.addEventListener("keyup", I),
        R = Or(k=>{
            if (!k.selectionText && (r(),
            !k.isEditableElement)) {
                h.current = null;
                return
            }
            h.current = k,
            k.selectionText && (k.eventType === "mouseup" ? _({
                target: null
            }) : I({
                target: null
            })),
            k.isEmbedPage && k.selectionText && k?.tagName === "BUTTON" && Br(),
            k.selectionText || d(ee=>({
                ...ee,
                open: !1
            }))
        }
        )),
        ()=>{
            document.removeEventListener("mouseup", _),
            document.removeEventListener("keyup", I),
            R()
        }
    }
    , [e]),
    Fn(async(_,I,R)=>{
        switch (_) {
        case "Client_listenOpenChatMessageBox":
            {
                let k = window.getSelection()?.rangeCount;
                if (k && k > 0) {
                    let W = window.getSelection()?.getRangeAt(0)?.cloneRange();
                    y({
                        range: W || null,
                        selectionText: window?.getSelection()?.toString() || ""
                    })
                }
                let {command: ee} = I
                  , O = ee === "show-floating-menu";
                if (!h.current) {
                    let W = bo()
                      , {editableElement: Y, isEditableElement: He} = Ft(W);
                    He && Y && (h.current = Yo(Y, {
                        target: Y,
                        eventType: "keyup"
                    }))
                }
                return et.info("Client_listenOpenChatMessageBox", h.current?.isEditableElement, h.current?.selectionText),
                b(h.current, {}, O),
                h.current && (h.current = null),
                {
                    success: !0,
                    data: {},
                    message: ""
                }
            }
            break
        }
    }
    );
    let X = (0,
    ae.useRef)("");
    (0,
    ae.useEffect)(()=>{
        X.current = x.lastOutput
    }
    , [x.lastOutput]);
    let xe = (0,
    ae.useRef)(u?.selectionElement);
    (0,
    ae.useEffect)(()=>{
        xe.current = u?.selectionElement
    }
    , [u]),
    (0,
    ae.useEffect)(()=>{
        let _ = xe.current || h.current
          , I = ["REPLACE_SELECTION", "INSERT_BELOW", "INSERT", "INSERT_ABOVE", "DISCARD", "COPY"]
          , R = go(x.selectContextMenuId || "");
        if (R)
            switch (I.includes(R) && (y({
                range: null,
                selectionText: ""
            }),
            d({
                open: !1,
                rootRect: null
            }),
            S({
                selectContextMenuId: "",
                lastOutput: ""
            }),
            r(),
            h.current = null),
            R) {
            case "INSERT_BELOW":
            case "INSERT":
            case "INSERT_ABOVE":
            case "REPLACE_SELECTION":
                _ && Ms.postMessage({
                    event: "Client_updateIframeInput",
                    data: {
                        value: X.current,
                        type: R,
                        startMarkerId: _.startMarkerId,
                        endMarkerId: _.endMarkerId,
                        caretOffset: _.caretOffset
                    }
                });
                break;
            case "TRY_AGAIN":
                {
                    let k = "";
                    if (m.length > 0) {
                        let ee = !1;
                        for (let O = m.length - 1; O >= 0; O--) {
                            let W = m[O];
                            if (W.type === "user" && (ee = !0),
                            ee && W.type === "ai") {
                                k = W.messageId;
                                break
                            }
                        }
                    }
                    p({
                        lastAIMessageId: k
                    })
                }
                break;
            case "COPY":
                try {
                    let k = document.createElement("textarea");
                    k.style.cssText = `
              position: fixed;
              top: 0;
              left: 0;
              width: 1px;
              height: 1px;
              padding: 0;
              border: none;
              outline: none;
              boxShadow: none;
              background: transparent;
              z-index: -1;
            `,
                    k.value = X.current,
                    document.body.appendChild(k),
                    k.select(),
                    document.execCommand("copy", !1, ""),
                    k.remove()
                } catch {}
                break;
            default:
                break
            }
    }
    , [x.selectContextMenuId]),
    (0,
    ae.useEffect)(()=>{
        l.open || y(_=>{
            if (_.range) {
                window.getSelection()?.removeAllRanges(),
                window.getSelection()?.addRange(_.range);
                let I = bo();
                if (I && (I.tagName === "INPUT" || I.tagName === "TEXTAREA")) {
                    let R = I
                      , k = R.value.indexOf(_.selectionText || "")
                      , ee = k + (_.selectionText || "").length;
                    R.focus(),
                    R.setSelectionRange(k, ee)
                }
                setTimeout(()=>{
                    let R = new KeyboardEvent("keyup",{
                        key: " ",
                        code: "Space",
                        location: 0,
                        bubbles: !0,
                        cancelable: !0,
                        shiftKey: !1
                    });
                    (I || document.body).focus(),
                    (I || document.body).dispatchEvent(R)
                }
                , 0)
            }
            return {
                ..._,
                range: null
            }
        }
        )
    }
    , [l.open])
}
  , Si = Es;
var Lo = A(D());
var bi = A(D());
var _s = {
    inviteLink: o=>(document.querySelector("#appMaxAIReferralShareOneClickText")?.innerText || "").trim() || `Sign up on MaxAI.me using my link and both of us will get a free week of MaxAI Pro rewards. It lets you use AI on any webpage with one click, powered by ChatGPT, Claude, Bard, and Bing AI. Here is my link: https://app.maxai.me?invite=${o}`
}
  , ct = _s;
var ws = ()=>{
    let {userInfo: o} = ze()
      , {setShortCuts: t, runShortCuts: e, loading: n, shortCutsEngineRef: r} = ye();
    return {
        autoFacebookReferral: (0,
        bi.useCallback)(async()=>{
            if (!n) {
                let u = ct.inviteLink(o?.referral_code || "");
                t([{
                    type: "OPEN_URLS",
                    parameters: {
                        URLActionURL: "https://www.facebook.com/sharer/sharer.php?u=https://app.maxai.me"
                    }
                }, {
                    type: "SET_VARIABLE",
                    parameters: {
                        VariableName: "OperationElementTabID"
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ["textarea[title]"],
                            actionType: "insertText",
                            actionExtraData: {
                                clearBeforeInsertText: !0,
                                text: ct.inviteLink(o?.referral_code || "")
                            },
                            beforeDelay: 2e3
                        }
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ['button[name="__CONFIRM__"]'],
                            actionType: "click",
                            afterDelay: 3e3
                        }
                    }
                }, {
                    type: "CLOSE_URLS",
                    parameters: {}
                }, {
                    type: "OPEN_URLS",
                    parameters: {
                        URLActionURL: "https://www.facebook.com/profile.php"
                    }
                }, {
                    type: "SET_VARIABLE",
                    parameters: {
                        VariableName: "OperationElementTabID"
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ['div[data-ad-preview="message"]', 'div[data-ad-comet-preview="message"]'],
                            executeElementCount: 10,
                            actionType: "getText",
                            beforeDelay: 2e3
                        }
                    }
                }, {
                    type: "SCRIPTS_CONDITIONAL",
                    parameters: {
                        WFCondition: "Contains",
                        WFMatchTextCaseSensitive: !1,
                        WFFormValues: {
                            Value: u.slice(0, 10),
                            WFSerializationType: "WFDictionaryFieldValue"
                        },
                        WFConditionalIfTrueActions: [{
                            type: "SET_VARIABLE",
                            parameters: {
                                VariableName: "AutoTwitterReferralResult",
                                WFFormValues: {
                                    Value: !0,
                                    WFSerializationType: "WFDictionaryFieldValue"
                                }
                            }
                        }],
                        WFConditionalIfFalseActions: [{
                            type: "SET_VARIABLE",
                            parameters: {
                                VariableName: "AutoTwitterReferralResult",
                                WFFormValues: {
                                    Value: !1,
                                    WFSerializationType: "WFDictionaryFieldValue"
                                }
                            }
                        }]
                    }
                }, {
                    type: "CLOSE_URLS",
                    parameters: {}
                }, {
                    type: "OPEN_URLS",
                    parameters: {
                        URLActionURL: "current_page"
                    }
                }]);
                let a = (s,c)=>{
                    let l = c?.action;
                    if (s === "afterRunAction" && l?.type === "SET_VARIABLE" && l.parameters?.VariableName === "AutoTwitterReferralResult") {
                        let d = l.parameters.WFFormValues?.Value === !0;
                        yt(`[Referral] One-click button [Facebook] ${d ? "Success" : "Fail"}`, JSON.stringify({
                            email: o?.email || "unknown",
                            success: d
                        }, null, 4), {
                            uuid: "608156c7-e65d-4a69-a055-6c10a6ba7217"
                        }).then().catch(),
                        d && St("/user/complete_referral", {
                            referral_types: ["FACEBOOK_SHARE"]
                        }).then()
                    }
                }
                ;
                return r.current?.addListener(a),
                await e(),
                r.current?.removeListener(a),
                !0
            }
            return !1
        }
        , [n, e, t, o?.referral_code]),
        autoFacebookReferralLoading: n
    }
}
  , Ii = ws;
var Mi = A(D());
var Ts = ()=>{
    let {userInfo: o} = ze()
      , {setShortCuts: t, runShortCuts: e, loading: n, shortCutsEngineRef: r} = ye();
    return {
        autoLinkedinReferral: (0,
        Mi.useCallback)(async()=>{
            if (!n) {
                let u = ct.inviteLink(o?.referral_code || "");
                t([{
                    type: "OPEN_URLS",
                    parameters: {
                        URLActionURL: "https://www.linkedin.com/shareArticle/?url=https%3A%2F%2Fapp.maxai.me%3Finvite%3DIPn7Xnby"
                    }
                }, {
                    type: "SET_VARIABLE",
                    parameters: {
                        VariableName: "OperationElementTabID"
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ["button.artdeco-button"],
                            actionType: "click",
                            beforeDelay: 2e3,
                            afterDelay: 2e3
                        }
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ['div[contenteditable="true"]'],
                            actionType: "insertText",
                            actionExtraData: {
                                clearBeforeInsertText: !0,
                                text: u
                            },
                            afterDelay: 1e3
                        }
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ["button.share-actions__primary-action"],
                            actionType: "click",
                            afterDelay: 3e3
                        }
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ["a.inshare-success-state__view-btn"],
                            actionType: "getLink"
                        }
                    }
                }, {
                    type: "SET_VARIABLE",
                    parameters: {
                        VariableName: "SHARE_POST_LINK"
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ["a.inshare-success-state__continue-btn"],
                            actionType: "getText"
                        }
                    }
                }, {
                    type: "SCRIPTS_CONDITIONAL",
                    parameters: {
                        WFCondition: "Contains",
                        WFMatchTextCaseSensitive: !1,
                        WFFormValues: {
                            Value: "linkedin",
                            WFSerializationType: "WFDictionaryFieldValue"
                        },
                        WFConditionalIfTrueActions: [{
                            type: "SET_VARIABLE",
                            parameters: {
                                VariableName: "AutoTwitterReferralResult",
                                WFFormValues: {
                                    Value: !0,
                                    WFSerializationType: "WFDictionaryFieldValue"
                                }
                            }
                        }],
                        WFConditionalIfFalseActions: [{
                            type: "SET_VARIABLE",
                            parameters: {
                                VariableName: "AutoTwitterReferralResult",
                                WFFormValues: {
                                    Value: !1,
                                    WFSerializationType: "WFDictionaryFieldValue"
                                }
                            }
                        }]
                    }
                }, {
                    type: "CLOSE_URLS",
                    parameters: {}
                }, {
                    type: "OPEN_URLS",
                    parameters: {
                        URLActionURL: "current_page"
                    }
                }]);
                let a = ""
                  , s = (c,l)=>{
                    let d = l?.action;
                    if (c === "afterRunAction" && d?.type === "SET_VARIABLE") {
                        if (d.parameters?.VariableName === "SHARE_POST_LINK")
                            a = d.output;
                        else if (d.parameters?.VariableName === "AutoTwitterReferralResult") {
                            let m = d.parameters.WFFormValues?.Value === !0;
                            yt(`[Referral] One-click button [Linkedin] ${m ? "Success" : "Fail"}`, JSON.stringify({
                                email: o?.email || "unknown",
                                success: m,
                                shareLink: `[ ${a} ]`
                            }, null, 4), {
                                uuid: "608156c7-e65d-4a69-a055-6c10a6ba7217"
                            }).then().catch(),
                            m && St("/user/complete_referral", {
                                referral_types: ["LINKEDIN_SHARE"]
                            })
                        }
                    }
                }
                ;
                return r.current?.addListener(s),
                await e(),
                r.current?.removeListener(s),
                !0
            }
            return !1
        }
        , [n, e, t, o?.referral_code]),
        autoLinkedinReferralLoading: n
    }
}
  , Ei = Ts;
var _i = A(D());
var vs = ()=>{
    let {userInfo: o} = ze()
      , {setShortCuts: t, runShortCuts: e, loading: n, shortCutsEngineRef: r} = ye();
    return {
        autoTwitterReferral: (0,
        _i.useCallback)(async()=>{
            if (!n) {
                let u = ct.inviteLink(o?.referral_code || "");
                t([{
                    type: "OPEN_URLS",
                    parameters: {
                        URLActionURL: `https://twitter.com/intent/tweet?text=${u}`
                    }
                }, {
                    type: "SET_VARIABLE",
                    parameters: {
                        VariableName: "OperationElementTabID"
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ['div[data-testid="tweetButton"]'],
                            actionType: "click",
                            beforeDelay: 2e3,
                            afterDelay: 2e3
                        }
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ['a[data-testid="AppTabBar_Profile_Link"]'],
                            actionType: "click",
                            afterDelay: 2e3
                        }
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ['article[data-testid="tweet"] div[data-testid="User-Name"] a[role="link"]'],
                            actionType: "getLink"
                        }
                    }
                }, {
                    type: "SET_VARIABLE",
                    parameters: {
                        VariableName: "SHARE_POST_LINK"
                    }
                }, {
                    type: "OPERATION_ELEMENT",
                    parameters: {
                        OperationElementConfig: {
                            elementSelectors: ['div[data-testid="tweetText"]'],
                            actionType: "getText",
                            executeElementCount: 10
                        }
                    }
                }, {
                    type: "SCRIPTS_CONDITIONAL",
                    parameters: {
                        WFCondition: "Contains",
                        WFMatchTextCaseSensitive: !1,
                        WFFormValues: {
                            Value: u.slice(0, 10),
                            WFSerializationType: "WFDictionaryFieldValue"
                        },
                        WFConditionalIfTrueActions: [{
                            type: "SET_VARIABLE",
                            parameters: {
                                VariableName: "AutoTwitterReferralResult",
                                WFFormValues: {
                                    Value: !0,
                                    WFSerializationType: "WFDictionaryFieldValue"
                                }
                            }
                        }, {
                            type: "CLOSE_URLS",
                            parameters: {}
                        }, {
                            type: "OPEN_URLS",
                            parameters: {
                                URLActionURL: "https://twitter.com/MaxAI_HQ"
                            }
                        }, {
                            type: "SET_VARIABLE",
                            parameters: {
                                VariableName: "OperationElementTabID"
                            }
                        }, {
                            type: "OPERATION_ELEMENT",
                            parameters: {
                                OperationElementConfig: {
                                    elementSelectors: ['div[data-testid="1667007582270296064-follow"]'],
                                    actionType: "click",
                                    beforeDelay: 2e3,
                                    afterDelay: 3e3
                                }
                            }
                        }],
                        WFConditionalIfFalseActions: [{
                            type: "SET_VARIABLE",
                            parameters: {
                                VariableName: "AutoTwitterReferralResult",
                                WFFormValues: {
                                    Value: !1,
                                    WFSerializationType: "WFDictionaryFieldValue"
                                }
                            }
                        }]
                    }
                }, {
                    type: "CLOSE_URLS",
                    parameters: {}
                }, {
                    type: "OPEN_URLS",
                    parameters: {
                        URLActionURL: "current_page"
                    }
                }]);
                let a = ""
                  , s = (c,l)=>{
                    let d = l?.action;
                    if (c === "afterRunAction" && d?.type === "SET_VARIABLE") {
                        if (d.parameters?.VariableName === "SHARE_POST_LINK")
                            a = d.output;
                        else if (d.parameters?.VariableName === "AutoTwitterReferralResult") {
                            let m = d.parameters.WFFormValues?.Value === !0;
                            yt(`[Referral] One-click button [Linkedin] ${m ? "Success" : "Fail"}`, JSON.stringify({
                                email: o?.email || "unknown",
                                success: m,
                                shareLink: `[ ${a} ]`
                            }, null, 4), {
                                uuid: "608156c7-e65d-4a69-a055-6c10a6ba7217"
                            }).then().catch(),
                            m && St("/user/complete_referral", {
                                referral_types: ["TWITTER_SHARE"]
                            })
                        }
                    }
                }
                ;
                return r.current?.addListener(s),
                await e(),
                r.current?.removeListener(s),
                !0
            }
            return !1
        }
        , [n, e, t, o?.referral_code]),
        autoTwitterReferralLoading: n
    }
}
  , wi = vs;
var As = ()=>{
    let {autoTwitterReferral: o} = wi()
      , {autoFacebookReferral: t} = Ii()
      , {autoLinkedinReferral: e} = Ei()
      , n = (0,
    Lo.useRef)({});
    (0,
    Lo.useEffect)(()=>{
        n.current = {
            twitter: o,
            linkedin: e,
            facebook: t
        }
    }
    , [o, e, t]),
    ke(()=>{
        Uo && location.href.includes(Uo) && setInterval(()=>{
            let r = document.querySelector("#appMaxAIReferralShareOneClickContainer")
              , i = document.querySelector("#appMaxAIReferralShareOneClickButton");
            if (r && i) {
                if (!r.classList.contains("loaded"))
                    r.classList.add("loaded");
                else
                    return;
                i.addEventListener("click", async()=>{
                    let u = Array.from(document.querySelectorAll('.app-maxai-me__one-click-share-status-card[data-checked="true"]'));
                    for (let l = 0; l < u.length; l++) {
                        let m = u[l].getAttribute("data-name")
                          , p = n.current?.[m];
                        p && await p()
                    }
                    await (l=>new Promise(d=>setTimeout(d, l)))(3e3);
                    let s = new URL(window.location.href)
                      , c = new URLSearchParams(s.search);
                    c.set("show_completed", "true"),
                    s.search = c.toString(),
                    window.location.href = s.toString()
                }
                )
            }
        }
        , 1e3)
    }
    )
}
  , Ti = As;
var pt = A(D());
var ks = ()=>{
    let {updateSidebarConversationType: o, currentSidebarConversationType: t} = ce()
      , [e,n] = (0,
    pt.useState)({
        origin: "",
        taskId: "",
        actions: []
    })
      , {setShortCuts: r, runShortCuts: i, loading: u} = ye("")
      , a = (0,
    pt.useRef)(!1);
    (0,
    pt.useEffect)(()=>{
        e.taskId && t === "Chat" && !a.current && (a.current = !0,
        r(e.actions),
        i().then(()=>{
            window.postMessage({
                id: "USECHATGPT_WEB_INJECT_RESPONSE",
                type: "runShortCutActionsResponse",
                taskId: e.taskId,
                data: {
                    success: !0,
                    error: ""
                }
            }, e.origin)
        }
        ).catch(s=>()=>{
            window.postMessage({
                id: "USECHATGPT_WEB_INJECT_RESPONSE",
                type: "runShortCutActionsResponse",
                taskId: e.taskId,
                data: {
                    success: !1,
                    error: "Network error."
                }
            }, e.origin)
        }
        ).finally(()=>{
            n({
                taskId: "",
                actions: [],
                origin: ""
            }),
            a.current = !1
        }
        ))
    }
    , [t, e, r, i]),
    (0,
    pt.useEffect)(()=>{
        let s = async c=>{
            if (c.data?.id === "USECHATGPT_WEB_INJECT") {
                let {taskId: l, type: d, data: m} = c.data;
                switch (d) {
                case "ping":
                    window.postMessage({
                        id: "USECHATGPT_WEB_INJECT_RESPONSE",
                        type: "pong",
                        taskId: l,
                        data: {
                            success: !0
                        }
                    }, c.origin);
                    break;
                case "runShortCutActions":
                    {
                        let {actions: p} = m;
                        a.current ? window.postMessage({
                            id: "USECHATGPT_WEB_INJECT_RESPONSE",
                            type: "runShortCutActionsResponse",
                            taskId: l,
                            data: {
                                success: !1,
                                error: "shortcuts is running"
                            }
                        }, c.origin) : (o("Chat"),
                        n({
                            origin: c.origin,
                            taskId: l,
                            actions: p
                        }));
                        break
                    }
                }
            }
        }
        ;
        return window.addEventListener("message", s),
        ()=>{
            window.removeEventListener("message", s)
        }
    }
    , [u, r, i])
}
  , vi = ks;
var Ai = ()=>{
    qt(async(o,t,e)=>{
        switch (o) {
        case "ShortCuts_ClientExecuteOperationPageElement":
            {
                let {taskId: n, OperationElementConfig: r} = t;
                return n ? (await zr(n, r),
                {
                    success: !0,
                    data: !0,
                    message: "ok"
                }) : {
                    success: !1,
                    message: "No taskId",
                    data: null
                }
            }
            break;
        default:
            break
        }
    }
    )
}
;
var Ne = A(D());
var mt = A(D())
  , Ps = ()=>{
    let[o,t] = (0,
    mt.useState)("")
      , e = (0,
    mt.useRef)("")
      , n = (0,
    mt.useRef)(document.title)
      , r = (0,
    mt.useRef)(0)
      , i = (0,
    mt.useRef)(null)
      , u = ()=>{
        a(),
        i.current = setInterval(()=>{
            let s = window.location.href;
            if (!e.current) {
                n.current = document.title,
                e.current = s;
                return
            }
            if (s === e.current) {
                n.current = document.title;
                return
            }
            s !== e.current && (r.current = 0),
            n.current !== document.title ? (r.current = 0,
            n.current = document.title,
            e.current = s,
            t(s)) : (r.current += 1,
            r.current > 10 && (r.current = 0,
            n.current = document.title,
            e.current = s,
            t(s)))
        }
        , 1e3)
    }
      , a = ()=>{
        i.current && clearInterval(i.current)
    }
    ;
    return {
        pageUrl: o,
        startListen: u,
        stopListen: a
    }
}
  , ki = Ps;
var dt = A(D());
var Bs = ()=>{
    let {updateSidebarSettings: o, currentSidebarConversationId: t, currentSidebarConversationType: e} = ce()
      , n = re(Jt)
      , r = re(Pe)
      , i = to()
      , {currentUserPlan: u} = ze()
      , {setShortCuts: a, runShortCuts: s} = ye("")
      , [c,l] = (0,
    dt.useState)([])
      , {createConversation: d} = bt()
      , m = (0,
    dt.useRef)(!1)
      , p = (0,
    dt.useRef)("")
      , y = async()=>{
        if (m.current)
            return;
        await Bt("ON_BOARDING_RECORD_AI_PROVIDER_HAS_AUTH_USE_CHAT_GPT_PLUS", !0);
        let x = Lt();
        if (r(S=>({
            ...S,
            loading: !0
        })),
        x) {
            let S = await Rt(x);
            if (S?.id) {
                await o({
                    summary: {
                        conversationId: x
                    }
                });
                let f = S.messages?.find(h=>Un(h));
                if (f && f?.originalMessage && f?.originalMessage.metadata?.isComplete) {
                    r(h=>({
                        ...h,
                        loading: !1
                    })),
                    n(h=>({
                        ...h,
                        [S.id]: S
                    }));
                    return
                } else
                    await st("clear", x, 0, [])
            }
            try {
                if (await d(),
                r(b=>({
                    ...b,
                    loading: !1
                })),
                u.name !== "pro" && u.name !== "elite") {
                    let b = Number((await Kt()).ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES) || 0;
                    if (b > 0)
                        await Bt("ON_BOARDING_RECORD_SUMMARY_FREE_TRIAL_TIMES", b - 1);
                    else {
                        await st("clear", x, 0, []),
                        await st("add", x, 0, [eo(i.PAGE_SUMMARY)]),
                        oo("show", "PAGE_SUMMARY");
                        return
                    }
                }
                let {actions: f, messageId: h} = Jn(Qn());
                p.current = h,
                l(f)
            } catch {}
        }
    }
    ;
    return (0,
    dt.useEffect)(()=>{
        c.length > 0 && !m.current && e === "Summary" && t && (m.current = !0,
        a(c) ? (l([]),
        s().then().catch().finally(()=>{
            m.current = !1;
            let x = Lt();
            x && p.current && st("update", x, 0, [{
                messageId: p.current,
                originalMessage: {
                    status: "complete",
                    metadata: {
                        sources: {
                            status: "complete"
                        },
                        isComplete: !0
                    }
                }
            }]).then().catch()
        }
        )) : (l([]),
        m.current = !1))
    }
    , [s, l, e, t, c]),
    {
        createPageSummary: y
    }
}
  , Pi = Bs;
var Ls = ()=>{
    let {createPageSummary: o} = Pi()
      , {pageUrl: t, startListen: e} = ki()
      , {sidebarSettings: n, currentSidebarConversationType: r, currentSidebarConversationId: i, updateSidebarSettings: u, updateSidebarConversationType: a} = ce()
      , s = re(Jt)
      , {switchBackgroundChatSystemAIProvider: c} = bt()
      , {continueInSearchWithAI: l} = Eo()
      , d = (0,
    Ne.useRef)("Chat")
      , m = (0,
    Ne.useRef)(n)
      , p = ir(n?.summary?.conversationId);
    (0,
    Ne.useEffect)(()=>{
        m.current = n
    }
    , [n]),
    (0,
    Ne.useEffect)(()=>{
        if (r) {
            switch (r) {
            case "Chat":
                break;
            case "Summary":
                o().then().catch().finally(()=>{
                    e()
                }
                );
                break;
            case "Search":
                break
            }
            d.current = r
        }
    }
    , [r]),
    (0,
    Ne.useEffect)(()=>{
        r === "Summary" && p && !i && o().then().catch().finally()
    }
    , [i, r]),
    Ko(()=>{
        d.current === "Summary" && u({
            summary: {
                conversationId: Lt()
            }
        })
    }
    ),
    (0,
    Ne.useEffect)(()=>{
        d.current === "Summary" && a("Chat")
    }
    , [t]);
    let y = (0,
    Ne.useRef)(i);
    (0,
    Ne.useEffect)(()=>{
        let x = !1;
        return i && Rt(i).then(async S=>{
            S?.meta.AIProvider && (x || await c(S.meta.AIProvider, S.meta.AIModel))
        }
        ),
        y.current = i,
        ()=>{
            x = !0
        }
    }
    , [i]),
    (0,
    Ne.useEffect)(()=>{
        let x = S=>{
            let f = S?.detail?.aiMessage;
            f && l(f).then().catch()
        }
        ;
        return window.addEventListener("MaxAIContinueSearchWithAI", x),
        ()=>{
            window.removeEventListener("MaxAIContinueSearchWithAI", x)
        }
    }
    ),
    Ko(()=>{
        if (y.current) {
            let x = new Date().getTime();
            Rt(y.current).then(S=>{
                S && s(f=>({
                    ...f,
                    [S.id]: S
                }))
            }
            )
        }
    }
    )
}
  , Bi = Ls;
var Rs = We(()=>{
    if (Me() === "youtube.com") {
        document.documentElement.style.position === "relative" && (document.documentElement.style.position = "unset",
        document.querySelector(`#${Wo}`)?.classList.replace("open", "close"));
        let t = document.querySelector(`#${Pt}`);
        t && (t.style.display = "none")
    }
}
, 100)
  , Ds = We(()=>{
    if (Me() === "youtube.com") {
        document.documentElement.style.position === "unset" && (document.documentElement.style.position = "relative",
        document.querySelector(`#${Wo}`)?.classList.replace("close", "open"));
        let t = document.querySelector(`#${Pt}`);
        t && (t.style.display = "")
    }
}
, 100)
  , Fs = ()=>{
    let o = Me();
    ke(()=>{
        if (o === "youtube.com") {
            let t = new MutationObserver(n=>{
                n.forEach(r=>{
                    r.target && (r.target.hasAttribute("scrolling") ? Rs() : Ds())
                }
                )
            }
            )
              , e = document.querySelector("ytd-app");
            e && t.observe(e, {
                attributes: !0,
                childList: !1,
                subtree: !1
            })
        }
    }
    )
}
  , Li = Fs;
var Ri = new xt("AppInit")
  , Os = ()=>window.location.host !== "www.usechatgpt.ai" && window.location.host !== "www.maxai.me" ? be.default.createElement(be.default.Fragment, null) : be.default.createElement($, {
    onClick: ()=>{
        me({
            key: "shortcuts"
        })
    }
    ,
    id: "usechatgpt-www-to-shortcuts",
    sx: {
        position: "absolute",
        width: 1,
        height: 1,
        zIndex: -1,
        opacity: 0
    }
})
  , Ns = ()=>{
    let o = re(qe)
      , t = re(Mn);
    return Wr(),
    (0,
    be.useEffect)(()=>{
        let e = async()=>{
            let n = await jt();
            n && (o({
                ...n
            }),
            Ri.info("get db settings", n));
            let r = await Gn();
            r && (t({
                ...r
            }),
            Ri.info("get local settings", r))
        }
        ;
        return e(),
        window.addEventListener("focus", e),
        ()=>{
            window.removeEventListener("focus", e)
        }
    }
    , []),
    be.default.createElement(be.default.Fragment, null)
}
  , Hs = ()=>(Li(),
vr(),
Qt(),
er(),
Ur(),
vi(),
Qr(),
rr(),
Bi(),
ke(()=>{
    An() && Be(),
    document.querySelector('embed[name][type="application/pdf"][internalid]') && me({
        key: "pdf_viewer"
    }),
    Gr(),
    Ai(),
    zn().then().catch(),
    $r()
}
),
Ti(),
Si(),
be.default.createElement(be.default.Fragment, null, be.default.createElement(Yr, null), be.default.createElement(Jr, null), be.default.createElement(Ci, null), be.default.createElement(Ns, null), be.default.createElement(Os, null)))
  , sg = Hs;
export {Ns as a, sg as b};
 